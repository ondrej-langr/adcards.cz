import{aH as q,r as i,aI as B,a as $,_ as J,e as C,a8 as H,s as X,aJ as k,u as M,b as K,M as u,E as V,f as Y,aK as Z,j as t,c as ee,H as te,D as O,B as F,aL as y,ad as se,A as ne,w as R,aM as oe,T as ae,g as ie,o as re}from"./index-cac_S5g_.js";import{H as A,L as ce,W as le,C as ue,D as me}from"./LanguageMutation-TpqP0h5i.js";import{g as de,a as ge,E as pe}from"./prepareFieldsForMapper-TTpMTl2W.js";import"./ImageSelect-foRB89a-.js";import"./useModelItems-yWM5Ht52.js";import"./FileList-wbIKmOFD.js";import{t as U}from"./toastedPromise-LzwZMqyf.js";import"./Divider-BM3oxIyc.js";import"./Flag-pb9lmjDx.js";import"./Skeleton-eoevnRmQ.js";import"./Table-MN18BIwN.js";import"./Select-ZUVIaLDV.js";import"./Textarea-I0w1xpMU.js";import"./use-disclosure--_1CWTEj.js";import"./useRequestWithNotifications-Dhk4Xh5J.js";import"./ItemsMissingMessage-WP2Z8gMA.js";import"./Drawer-g9Y-9ZlZ.js";import"./NativeScrollArea-Q3mUJQz_.js";import"./Overlay-RVC-BiIf.js";import"./Repeater-EySG-NVD.js";import"./Modal-RveEWUIE.js";const fe=s=>{const{singletons:n}=q();return i.useMemo(()=>n&&n[s],[s,n])};console.log({SingletonUnderpageRoute:B});const x=(s=!1)=>{const{singletonId:n}=$({from:B.id}),e=i.useMemo(()=>String(n),[n]),o=fe(e);if(s&&!o)throw new Error("Model not found");return i.useMemo(()=>o?{...o,key:e}:void 0,[e,o])};function he({queryKey:s}){return C.singletons.for(s[0]).get(s[1]).then(({data:n})=>n.data)}function z(s,n){const e=x(!0);return J([e.key,s],he,n)}z.refetch=()=>{};const G=i.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),W=()=>i.useContext(G),Ee=({children:s})=>{var h,c;const n=H(),e=x(!0),o=i.useMemo(()=>{if(!e)return;const _=de(e,!0);return async(b,T,j)=>{const m=await X(_)(b,T,j);return k.warning("Validating form:"),k.warning({data:b,result:m}),m}},[e]),{t:l}=M(),[r,a]=i.useState((c=(h=n.application)==null?void 0:h.i18n)==null?void 0:c.default),{data:d,isLoading:I,refetch:g}=z({language:r},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),p=K({defaultValues:ge(e,d??{}),reValidateMode:"onChange",mode:"onTouched",resolver:o}),{handleSubmit:w,setError:D}=p;i.useEffect(()=>{d&&p.reset(d)},[d,p.reset]);const N=w(async _=>{var T,j;const b=e.key;try{await U({title:"Updating",message:l(u.PLEASE_WAIT),successMessage:l(u.ITEM_UPDATE_DONE)},async()=>{const m=V(d,_);await C.singletons.for(b).update(m,{language:r}),await g()})}catch(m){if(Y.isAxiosError(m)&&Z(m.response)&&((T=m.response.headers["content-description"])!=null&&T.includes(String(pe)))){const P=m.response.data.data;if(Array.isArray(P)&&P.length)for(const L of P){const E=(j=e==null?void 0:e.columns)==null?void 0:j.find(Q=>Q.name===L);if(!E)continue;let v=L;L==="slug"&&(E==null?void 0:E.type)==="slug"&&(v=E.of),D(v,{message:l(u.FIELD_REQUIRED)})}}}}),S=i.useCallback(async()=>U({title:l(u.PLEASE_WAIT),message:l(u.ITEM_SINGLETON_DELETE_DONE),successMessage:l(u.ITEM_SINGLETON_DELETE_DONE),errorMessage:l(u.ITEM_SINGLETON_DELETE_FAILED)},async()=>{await C.singletons.for(e==null?void 0:e.key).clear(),await g()}),[e,l,p.reset]),f=i.useMemo(()=>({language:r,setLanguage:a,data:d,isLoading:I,clear:S}),[r,a,S]);return t.jsx(ee,{...p,children:t.jsx(G.Provider,{value:f,children:t.jsx("form",{onSubmit:N,children:s})})})},xe=()=>{const{name:s,title:n,columns:e}=x(!0),{t:o}=M();return i.useMemo(()=>e&&!!e.find(r=>!r.hide&&r.admin.editor.placement===te.MAIN&&r.type==="string"&&r.admin.fieldType==="heading"),[e])?null:t.jsxs(A,{children:[t.jsxs(A.Title,{children:[o(u.UPDATE_ITEM)," ",n||s]}),t.jsx(A.Divider,{})]})},Se=()=>{const{formState:s,reset:n}=O(),{t:e}=M(),{clear:o}=W(),[l,r]=i.useState(!1),a=async()=>{confirm(e(u.ON_DELETE_REQUEST_PROMPT))&&(await o(),n())};return t.jsxs(y,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>r(!0),onClose:()=>r(!1),children:[t.jsx(y.Target,{children:t.jsx(se,{withArrow:!0,label:e(u.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:l,children:t.jsx(ne,{size:"xl",color:"gray",variant:"light",type:"button",className:R(s.isSubmitting&&"!cursor-progress"),loading:s.isSubmitting,styles:{root:{width:50,height:50}},children:t.jsx(oe,{className:"aspect-square w-20 duration-150"})})})}),t.jsx(y.Dropdown,{children:t.jsx(y.Item,{type:"button",onClick:a,color:"red",className:R(s.isSubmitting&&"!cursor-progress"),leftSection:t.jsx(ae,{className:"aspect-square w-4"}),children:e(u.PURGE_DATA)})})]})},be=()=>{var h;const{watch:s}=O(),n=s(),{t:e}=M(),{data:o,setLanguage:l,language:r}=W(),a=x(),d=H(),{setValue:I,formState:g}=O(),p=i.useMemo(()=>!!Object.keys(V(o||{},n)).length,[n,o]),w=()=>{},D=i.useMemo(()=>{let c="";return g.isSubmitting?c="Updating":c="Update",e(c)},[g.isSubmitting,e]),N=i.useMemo(()=>{let c="";return!(a!=null&&a.draftable)||!o?c:(o.published?c="Unpublish":c="Publish",e(c))},[o,g.isSubmitting,a,e]),S=()=>{I("published",o?!o.published:!1)},f=i.useMemo(()=>a==null?void 0:a.columns.filter(c=>c.localized),[a]);return t.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-end gap-2 px-5 rounded-prom bg-transparent",children:[(a==null?void 0:a.draftable)&&t.jsx(F,{size:"sm",variant:"transparent",type:"submit",disabled:g.isSubmitting,className:"ml-auto",onClick:S,px:"sm",children:N}),t.jsx(F,{size:"lg",color:"green",type:"submit",disabled:!p,loading:g.isSubmitting,onClick:w,children:D}),(((h=d.application)==null?void 0:h.i18n.languages.length)??0)>1&&(f!=null&&f.length)?t.jsx(ce,{language:r??"",onSelect:l}):null,t.jsx(Se,{})]})},Ge=ie("/_authorized/entities/singletons/$singletonId/")({component:je}),Te=()=>{const s=x(!0);return t.jsx(me,{modelInfo:s})};function je(){return t.jsx(Ee,{children:t.jsxs(re,{rightAsideOutlet:!0,children:[t.jsx(be,{}),t.jsx(le,{children:t.jsxs(ue,{children:[t.jsx(xe,{}),t.jsx(Te,{})]})})]})})}export{Ge as Route};
