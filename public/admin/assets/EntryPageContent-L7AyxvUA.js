import{aY as be,W as ae,R as w,aZ as T,a_ as fe,V as je,a$ as ye,al as Ne,b0 as Se,r as p,b1 as ne,u as j,H as L,j as e,m as M,M as f,D as v,A as oe,T as le,a2 as z,b2 as R,B as V,p as we,aw as ve,aj as S,b3 as ee,w as D,y as Ce,L as Ee,x as Oe,a1 as Te,E as _e,aS as O,a8 as Ae,aT as Ie,e as Pe,o as Ue}from"./index-UkeQhmow.js";import{L as ke,H as F,W as Re,C as Fe,D as Le}from"./LanguageMutation-rU1IZZ2b.js";import{p as Ve,F as De,b as C,d as Be,e as He}from"./prepareFieldsForMapper-qzIJNNy9.js";import{A as W}from"./AsideItemWrap-NW8lo9sP.js";import{A as Me}from"./AsideWrapper-2NbwYueF.js";import{u as ze}from"./mustache-hdmEeTIN.js";import{u as ie}from"./useModelItems-1E8lchLJ.js";import{S as N}from"./Skeleton-VlALSyZX.js";import{g as We,a as $e,u as Ye,C as B,O as qe}from"./Select-3J8J3tZj.js";import"./LanguageSelect-Jej8Jmsy.js";var re={root:"m-849cf0da"};const Ge={underline:"hover"},$=be((s,t)=>{const{underline:a,className:n,unstyled:o,mod:l,...c}=ae("Anchor",Ge,s);return w.createElement(T,{component:"a",ref:t,className:fe({[re.root]:!o},n),...c,mod:[{underline:a},l],__staticSelector:"Anchor",unstyled:o})});$.classes=re;$.displayName="@mantine/core/Anchor";const Ke={},Y=je((s,t)=>{const a=ae("Autocomplete",Ke,s),{classNames:n,styles:o,unstyled:l,vars:c,dropdownOpened:r,defaultDropdownOpened:d,onDropdownClose:u,onDropdownOpen:i,onFocus:x,onBlur:g,onClick:y,onChange:_,data:A,value:E,defaultValue:m,selectFirstOptionOnChange:I,onOptionSubmit:P,comboboxProps:ce,readOnly:U,disabled:q,filter:de,limit:ue,withScrollArea:me,maxDropdownHeight:pe,size:G,id:he,...xe}=a,K=ye(he),X=We(A),ge=$e(X),[k,Q]=Ne({value:E,defaultValue:m,finalValue:"",onChange:_}),b=Ye({opened:r,defaultOpened:d,onDropdownOpen:i,onDropdownClose:()=>{u==null||u(),b.resetSelectedOption()}}),{resolvedClassNames:Z,resolvedStyles:J}=Se({props:a,styles:o,classNames:n});return p.useEffect(()=>{I&&b.selectFirstOption()},[I,k]),w.createElement(B,{store:b,__staticSelector:"Autocomplete",classNames:Z,styles:J,unstyled:l,readOnly:U,onOptionSubmit:h=>{P==null||P(h),Q(ge[h].label),b.closeDropdown()},size:G,...ce},w.createElement(B.Target,null,w.createElement(ne,{ref:t,...xe,size:G,__staticSelector:"Autocomplete",disabled:q,readOnly:U,value:k,onChange:h=>{Q(h.currentTarget.value),b.openDropdown(),I&&b.selectFirstOption()},onFocus:h=>{b.openDropdown(),x==null||x(h)},onBlur:h=>{b.closeDropdown(),g==null||g(h)},onClick:h=>{b.openDropdown(),y==null||y(h)},classNames:Z,styles:J,unstyled:l,id:K})),w.createElement(qe,{data:X,hidden:U||q,filter:de,search:k,limit:ue,hiddenWhenEmpty:!0,withScrollArea:me,maxDropdownHeight:pe,unstyled:l,labelId:`${K}-label`}))});Y.classes={...ne.classes,...B.classes};Y.displayName="@mantine/core/Autocomplete";const Xe=({model:s})=>{const{t}=j(),a=p.useMemo(()=>{if(s)return Ve(s,L.ASIDE)},[s]);return a&&a.length?e.jsx(W,{title:t("Other info"),children:e.jsx("div",{className:"mb-5 grid gap-5 p-2",children:e.jsx(De,{type:L.ASIDE,fields:a})})}):null};p.forwardRef(function({avatar:t,email:a,id:n,name:o,password:l,role:c,state:r,...d},u){const{data:i,isLoading:x}=ze("userRoles",typeof c=="string"?c:c.id);return e.jsxs("div",{ref:u,...d,children:[e.jsx(T,{children:o}),e.jsx(T,{size:"xs",color:"blue",children:!i||x?e.jsx(N,{width:100,height:20}):i.label})]})});const Qe=({withLabel:s=!0,...t})=>{const{t:a}=j(),{data:n}=ie(M.USERS,{params:{limit:5,where:{...t.value&&Number.isNaN(Number(t.value))?{name:{manipulator:"LIKE",value:`%${t.value}%`}}:{},...t.value&&!Number.isNaN(Number(t.value))?{id:{manipulator:"LIKE",value:t.value}}:{}}}},{enabled:!!t.value});return e.jsx(Y,{label:s?a(f.USER):void 0,placeholder:a("Start typing to see options"),...t,data:((n==null?void 0:n.data)||[]).map(o=>({...o,value:String(o.name)}))})},Ze=e.jsxs(e.Fragment,{children:[e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30})]}),Je=({id:s,name:t,onItemDelete:a})=>e.jsxs("div",{className:"flex justify-between rounded-lg bg-gray-50 px-4 py-2",children:[e.jsx(T,{size:"lg",children:t}),e.jsx(oe,{color:"red",variant:"light",onClick:()=>a(s),children:e.jsx(le,{width:20,height:20})})]}),es=()=>{const{watch:s,setValue:t,getValues:a}=v(),n=s("coeditors"),o=!Object.keys(n||{}).length,{data:l,isLoading:c}=ie(M.USERS,{params:{limit:999,where:{id:{manipulator:"IN",value:Object.keys(n||{})}}}},{enabled:!o}),r=p.useCallback(d=>{const u="coeditors",{...i}=a(u);delete i[d],t(u,i)},[t,a]);return!c||o?e.jsx(e.Fragment,{children:((l==null?void 0:l.data)||[]).map(d=>e.jsx(Je,{onItemDelete:r,...d},d.id))}):Ze},ss=()=>{const{itemData:s}=C(),t=z(),[a,n]=p.useState(!1),[o,l]=p.useState(),[c,r]=p.useState(!1),{setValue:d,getValues:u}=v(),{t:i}=j(),x=p.useCallback(({id:g})=>{n(!0);const y=u("coeditors")??{};d("coeditors",{...y,[String(g)]:!0}),n(!1),r(!1),l("")},[u,d]);return!(t!=null&&t.can({action:"update",targetEntityTableName:M.USER_ROLES}))&&(t==null?void 0:t.id)!==(s==null?void 0:s.created_by)?null:e.jsx(e.Fragment,{children:e.jsx(W,{title:i(f.CONTRIBUTORS),description:i(f.ADD_CONTRIBUTOR_TEXT),children:e.jsxs("div",{className:"grid grid-cols-1 gap-2.5 p-2.5",children:[e.jsx(es,{}),e.jsxs(R,{closeOnClickOutside:!1,closeOnEscape:!1,opened:c,onClose:()=>r(!1),position:"bottom",transitionProps:{transition:"pop-top-right"},width:400,children:[e.jsx(R.Target,{children:e.jsx(V,{className:"w-full",leftSection:e.jsx(we,{className:"h-7 w-7"}),variant:"light",type:"button",onClick:()=>r(g=>!g),children:e.jsx("span",{className:"ml-auto inline-block",children:i(f.ADD_CONTRIBUTOR)})})}),e.jsxs(R.Dropdown,{className:"w-full",title:i("Select user"),children:[e.jsx(Qe,{withLabel:!1,disabled:a,value:o,onChange:l,onItemSubmit:x}),e.jsx(ve,{justify:"space-between",style:{marginTop:15},children:e.jsx($,{component:"button",color:"gray",size:"sm",disabled:a,onClick:()=>r(!1),children:i("Cancel")})})]})]})]})})})},H=({className:s,...t})=>e.jsx(N,{className:D("relative top-0.5 inline-block h-4",s),...t}),se=({userId:s})=>{const{t}=j(),{data:a,isLoading:n}=Ce(s,{enabled:!!s}),o=z(),l=Number(s)===Number(o==null?void 0:o.id);return n||!a||!s?e.jsx(H,{className:"inline-block"}):e.jsx(Ee,{to:l?"/settings/profile":Oe.users.view(s),className:"font-semibold text-blue-600",children:l?t("Me"):a.name})},te="D.M. YYYY, HH:mm",ts=()=>{const{itemData:s,itemIsLoading:t}=C(),{t:a}=j(),n=S();return!(n!=null&&n.timestamp)&&!(n!=null&&n.ownable)?null:e.jsx(W,{className:"!pt-0",title:a(f.PUBLISH_INFO),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[(n==null?void 0:n.timestamp)&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[a("Updated at"),":"," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?ee(s.updated_at).format(te):a("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[a("Created at"),":"," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(s.created_at).format(te)})]})]}),(n==null?void 0:n.ownable)&&e.jsxs(e.Fragment,{children:[!!(s!=null&&s.updated_by)&&String(s==null?void 0:s.updated_by)!=="0"&&e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a("Updated by"),":"]})," ",e.jsx(se,{userId:s==null?void 0:s.updated_by})]})}),e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a("Created by"),":"]})," ",s!=null&&s.created_by&&String(s==null?void 0:s.created_by)!=="0"?e.jsx(se,{userId:s==null?void 0:s.created_by}):a("Unknown")]})})]})]})})})},as=()=>{const s=S(!0);return e.jsxs(Me,{isOpen:!0,children:[e.jsx(ts,{}),e.jsx(Xe,{model:s}),s&&s.sharable&&e.jsx(ss,{})]})},ns=()=>{const{formState:s}=v(),{t}=j(),{itemData:a,currentView:n,exitView:o}=C(),l=S(),c=z(),[r,d]=p.useState(!1),u=n==="update"&&l&&(c==null?void 0:c.can({action:"create",targetEntityTableName:l==null?void 0:l.name})),i=async()=>{confirm(t(f.ON_DELETE_REQUEST_PROMPT))&&(o(),await Pe.entries.for(l==null?void 0:l.name).delete(a==null?void 0:a.id))};return e.jsxs(O,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>d(!0),onClose:()=>d(!1),children:[e.jsx(O.Target,{children:e.jsx(Ae,{withArrow:!0,label:t(f.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:r,children:e.jsx(oe,{size:"xl",color:"gray",variant:"light",type:"button",className:D(s.isSubmitting&&"!cursor-progress"),loading:s.isSubmitting,styles:{root:{width:50,height:50}},children:e.jsx(Ie,{className:"aspect-square w-20 duration-150"})})})}),e.jsx(O.Dropdown,{children:u?e.jsx(O.Item,{type:"button",onClick:i,color:"red",className:D(s.isSubmitting&&"!cursor-progress"),leftSection:e.jsx(le,{className:"aspect-square w-4"}),children:t(f.PURGE_DATA)}):null})]})},os=()=>{var E;const{watch:s}=v(),t=s(),{t:a}=j(),{itemData:n,currentView:o,setLanguage:l,language:c}=C(),r=S(),d=Te(),{setValue:u,formState:i}=v(),x=p.useMemo(()=>o==="update"?!!Object.keys(_e(n||{},t)).length:!0,[t,o,n]),g=()=>{o==="create"&&u("is_published",!0)},y=p.useMemo(()=>{let m="";return o==="create"?i.isSubmitting?m="Publishing":m="Publish":o==="update"&&(i.isSubmitting?m="Updating":m="Update"),a(m)},[o,i.isSubmitting,a]),_=p.useMemo(()=>{let m="";if(!(r!=null&&r.draftable))return m;if(o==="create")i.isSubmitting?m="Saving":m="Save as concept";else if(o==="update"){if(!n)return m;n.is_published?m="Unpublish":m="Publish"}return a(m)},[o,i.isSubmitting,r,n,a]),A=()=>{u("is_published",n?!n.is_published:!1)};return e.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between px-5 rounded-prom bg-transparent",children:[e.jsx("div",{className:"flex gap-3 justify-center"}),e.jsxs("div",{className:"flex items-center gap-3",children:[(r==null?void 0:r.draftable)&&e.jsx(V,{size:"sm",variant:"transparent",type:"submit",disabled:i.isSubmitting,className:"ml-auto",onClick:A,px:"sm",children:_}),e.jsx(V,{size:"lg",color:"green",type:"submit",disabled:!x,loading:i.isSubmitting,onClick:g,children:y}),(((E=d.application)==null?void 0:E.i18n.languages.length)??0)>1&&o==="update"?e.jsx(ke,{language:c??"",onSelect:l}):null,e.jsx(ns,{})]})]})},ls=()=>{const{currentView:s}=C(),t=S(),{t:a}=j();return p.useMemo(()=>(t==null?void 0:t.columns)&&!!(t!=null&&t.columns.find(o=>!o.hide&&o.admin.editor.placement===L.MAIN&&o.type==="string"&&o.admin.fieldType==="heading")),[t])?null:e.jsxs(F,{children:[e.jsx(F.Title,{children:a(s=="update"?"Update an entry":"Create an entry")}),e.jsx(F.Divider,{})]})},bs=({viewType:s})=>{const t=S();return e.jsx(Be,{viewType:s,children:e.jsx(He.Consumer,{children:({onSubmit:a})=>e.jsx("form",{autoComplete:"off",onSubmit:a,children:e.jsxs(Ue,{rightAsideOutlet:e.jsx(as,{}),children:[e.jsx(os,{}),e.jsx(Re,{children:e.jsxs(Fe,{children:[e.jsx(ls,{}),e.jsx(Le,{modelInfo:t})]})})]})})})})};export{bs as E};
