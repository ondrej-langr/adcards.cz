import{aR as je,J as ae,R as w,aS as A,aT as ye,I as Ne,N as Se,Z as we,aU as ve,r as p,Y as ne,u as j,H as I,j as e,e as le,_ as Ee,m as P,M as f,D as v,A as oe,T as ie,a9 as z,aV as L,B as F,p as Oe,aA as Ce,aq as E,aW as ee,w as V,y as Te,L as Ae,x as Ie,a8 as Pe,E as Re,aN as T,af as _e,aO as De,o as Ue}from"./index-yOKIGyhs.js";import{p as re,F as ke,b as O,d as Le,e as Be}from"./prepareFieldsForMapper-n-XwGTf5.js";import"./ImageSelect-uTX8WRsl.js";import{u as ce}from"./useModelItems-swOYtnuG.js";import"./FileList-e-NMcu-p.js";import{A as W}from"./AsideItemWrap-x2lTjCPL.js";import{A as Fe}from"./AsideWrapper-iPoJxVBH.js";import{H as B,L as Ve,W as Me,C as He,D as ze}from"./LanguageMutation-SmwVOs74.js";import{S as N}from"./Skeleton-ai2isshM.js";import{g as We,a as Ye,u as $e,C as M,O as qe}from"./Select-Tmriee6U.js";import"./LanguageSelect-6tvgF7cz.js";var de={root:"m-849cf0da"};const Ke={underline:"hover"},Y=je((t,s)=>{const{underline:a,className:n,unstyled:l,mod:o,...c}=ae("Anchor",Ke,t);return w.createElement(A,{component:"a",ref:s,className:ye({[de.root]:!l},n),...c,mod:[{underline:a},o],__staticSelector:"Anchor",unstyled:l})});Y.classes=de;Y.displayName="@mantine/core/Anchor";const Ge={},$=Ne((t,s)=>{const a=ae("Autocomplete",Ge,t),{classNames:n,styles:l,unstyled:o,vars:c,dropdownOpened:i,defaultDropdownOpened:u,onDropdownClose:m,onDropdownOpen:r,onFocus:x,onBlur:g,onClick:y,onChange:R,data:_,value:S,defaultValue:C,selectFirstOptionOnChange:d,onOptionSubmit:D,comboboxProps:ue,readOnly:U,disabled:q,filter:me,limit:pe,withScrollArea:he,maxDropdownHeight:xe,size:K,id:ge,...be}=a,G=Se(ge),Q=We(_),fe=Ye(Q),[k,X]=we({value:S,defaultValue:C,finalValue:"",onChange:R}),b=$e({opened:i,defaultOpened:u,onDropdownOpen:r,onDropdownClose:()=>{m==null||m(),b.resetSelectedOption()}}),{resolvedClassNames:J,resolvedStyles:Z}=ve({props:a,styles:l,classNames:n});return p.useEffect(()=>{d&&b.selectFirstOption()},[d,k]),w.createElement(M,{store:b,__staticSelector:"Autocomplete",classNames:J,styles:Z,unstyled:o,readOnly:U,onOptionSubmit:h=>{D==null||D(h),X(fe[h].label),b.closeDropdown()},size:K,...ue},w.createElement(M.Target,null,w.createElement(ne,{ref:s,...be,size:K,__staticSelector:"Autocomplete",disabled:q,readOnly:U,value:k,onChange:h=>{X(h.currentTarget.value),b.openDropdown(),d&&b.selectFirstOption()},onFocus:h=>{b.openDropdown(),x==null||x(h)},onBlur:h=>{b.closeDropdown(),g==null||g(h)},onClick:h=>{b.openDropdown(),y==null||y(h)},classNames:J,styles:Z,unstyled:o,id:G})),w.createElement(qe,{data:Q,hidden:U||q,filter:me,search:k,limit:pe,hiddenWhenEmpty:!0,withScrollArea:he,maxDropdownHeight:xe,unstyled:o,labelId:`${G}-label`}))});$.classes={...ne.classes,...M.classes};$.displayName="@mantine/core/Autocomplete";const Qe=({model:t})=>{const{t:s}=j(),a=p.useMemo(()=>{if(t)return re(t,I.ASIDE)},[t]);return a&&a.length?e.jsx(W,{title:s("Other info"),children:e.jsx("div",{className:"mb-5 flex flex-wrap gap-y-5 items-baseline p-2",children:e.jsx(ke,{type:I.ASIDE,fields:a})})}):null},Xe=(t,s,a)=>{const n=p.useCallback(()=>le.userRoles.getOne(t,s).then(({data:l})=>l.data),[t,s]);return Ee([P.USER_ROLES,s],n,{enabled:!!t,...a})};p.forwardRef(function({avatar:s,email:a,id:n,name:l,password:o,role:c,state:i,...u},m){const{data:r,isLoading:x}=Xe(typeof c=="string"?c:c==null?void 0:c.id);return e.jsxs("div",{ref:m,...u,children:[e.jsx(A,{children:l}),e.jsx(A,{size:"xs",color:"blue",children:!r||x?e.jsx(N,{width:100,height:20}):r.label})]})});const Je=({withLabel:t=!0,...s})=>{const{t:a}=j(),{data:n}=ce(P.USERS,{params:{limit:5,where:{...s.value&&Number.isNaN(Number(s.value))?{name:{manipulator:"LIKE",value:`%${s.value}%`}}:{},...s.value&&!Number.isNaN(Number(s.value))?{id:{manipulator:"LIKE",value:s.value}}:{}}}},{enabled:!!s.value});return e.jsx($,{label:t?a(f.USER):void 0,placeholder:a("Start typing to see options"),...s,data:((n==null?void 0:n.data)||[]).map(l=>({...l,value:String(l.name)}))})},Ze=e.jsxs(e.Fragment,{children:[e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30})]}),es=({id:t,name:s,onItemDelete:a})=>e.jsxs("div",{className:"flex justify-between rounded-lg bg-gray-50 px-4 py-2",children:[e.jsx(A,{size:"lg",children:s}),e.jsx(oe,{color:"red",variant:"light",onClick:()=>a(t),children:e.jsx(ie,{width:20,height:20})})]}),ss=()=>{const{watch:t,setValue:s,getValues:a}=v(),n=t("coeditors"),l=!Object.keys(n||{}).length,{data:o,isLoading:c}=ce(P.USERS,{params:{limit:999,where:{id:{manipulator:"IN",value:Object.keys(n||{})}}}},{enabled:!l}),i=p.useCallback(u=>{const m="coeditors",{...r}=a(m);delete r[u],s(m,r)},[s,a]);return!c||l?e.jsx(e.Fragment,{children:((o==null?void 0:o.data)||[]).map(u=>e.jsx(es,{onItemDelete:i,...u},u.id))}):Ze},ts=()=>{const{itemData:t}=O(),s=z(),[a,n]=p.useState(!1),[l,o]=p.useState(),[c,i]=p.useState(!1),{setValue:u,getValues:m}=v(),{t:r}=j(),x=p.useCallback(({id:g})=>{n(!0);const y=m("coeditors")??{};u("coeditors",{...y,[String(g)]:!0}),n(!1),i(!1),o("")},[m,u]);return!(s!=null&&s.can({action:"update",targetEntityTableName:P.USER_ROLES}))&&(s==null?void 0:s.id)!==(t==null?void 0:t.created_by)?null:e.jsx(e.Fragment,{children:e.jsx(W,{title:r(f.CONTRIBUTORS),description:r(f.ADD_CONTRIBUTOR_TEXT),children:e.jsxs("div",{className:"grid grid-cols-1 gap-2.5 p-2.5",children:[e.jsx(ss,{}),e.jsxs(L,{closeOnClickOutside:!1,closeOnEscape:!1,opened:c,onClose:()=>i(!1),position:"bottom",transitionProps:{transition:"pop-top-right"},width:400,children:[e.jsx(L.Target,{children:e.jsx(F,{className:"w-full",leftSection:e.jsx(Oe,{className:"h-7 w-7"}),variant:"light",type:"button",onClick:()=>i(g=>!g),children:e.jsx("span",{className:"ml-auto inline-block",children:r(f.ADD_CONTRIBUTOR)})})}),e.jsxs(L.Dropdown,{className:"w-full",title:r("Select user"),children:[e.jsx(Je,{withLabel:!1,disabled:a,value:l,onChange:o,onItemSubmit:x}),e.jsx(Ce,{justify:"space-between",style:{marginTop:15},children:e.jsx(Y,{component:"button",color:"gray",size:"sm",disabled:a,onClick:()=>i(!1),children:r("Cancel")})})]})]})]})})})},H=({className:t,...s})=>e.jsx(N,{className:V("relative top-0.5 inline-block h-4",t),...s}),se=({id:t,name:s})=>{const{t:a}=j(),{data:n,isLoading:l}=Te(t,{enabled:!!t&&!s}),o=z(),c=(n==null?void 0:n.name)??s,i=Number(t)===Number(o==null?void 0:o.id)||c===(o==null?void 0:o.name);return l&&!s||!c||!t?e.jsx(H,{className:"inline-block"}):e.jsx(Ae,{to:i?"/settings/profile":Ie.users.view(t),className:"font-semibold text-blue-600",children:i?a("Me"):c})},te="D.M. YYYY, HH:mm",as=()=>{const{itemData:t,itemIsLoading:s}=O(),{t:a}=j(),n=E();return e.jsx(W,{className:"!pt-0",title:a(f.PUBLISH_INFO),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[(n==null?void 0:n.timestamp)&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[a("Updated at"),":"," ",s?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:t!=null&&t.updatedAt?ee(t.updatedAt).format(te):a("Not edited yet")})]}),!!(t!=null&&t.createdAt)&&e.jsxs("li",{children:[a("Created at"),":"," ",s?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(t.createdAt).format(te)})]})]}),(n==null?void 0:n.ownable)&&e.jsxs(e.Fragment,{children:[t!=null&&t.updatedBy?e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a("Updated by"),":"]})," ",e.jsx(se,{...t.updatedBy})]})}):null,t!=null&&t.createdBy?e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a("Created by"),":"]})," ",e.jsx(se,{...t.createdBy})]})}):null]})]})})})},ns=()=>{const{currentView:t}=O(),s=E(),{t:a}=j();return p.useMemo(()=>(s==null?void 0:s.columns)&&!!(s!=null&&s.columns.find(l=>!l.hide&&l.admin.editor.placement===I.MAIN&&l.type==="string"&&l.admin.fieldType==="heading")),[s])?null:e.jsxs(B,{children:[e.jsx(B.Title,{children:a(t=="update"?"Update an entry":"Create an entry")}),e.jsx(B.Divider,{})]})},ls=()=>{const{formState:t}=v(),{t:s}=j(),{itemData:a,currentView:n,exitView:l}=O(),o=E(),c=z(),[i,u]=p.useState(!1),m=n==="update"&&o&&(c==null?void 0:c.can({action:"create",targetEntityTableName:o==null?void 0:o.name})),r=async()=>{confirm(s(f.ON_DELETE_REQUEST_PROMPT))&&(l(),await le.entries.for(o==null?void 0:o.name).delete(a==null?void 0:a.id))};return e.jsxs(T,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>u(!0),onClose:()=>u(!1),children:[e.jsx(T.Target,{children:e.jsx(_e,{withArrow:!0,label:s(f.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:i,children:e.jsx(oe,{size:"xl",color:"gray",variant:"light",type:"button",className:V(t.isSubmitting&&"!cursor-progress"),loading:t.isSubmitting,styles:{root:{width:50,height:50}},children:e.jsx(De,{className:"aspect-square w-20 duration-150"})})})}),e.jsx(T.Dropdown,{children:m?e.jsx(T.Item,{type:"button",onClick:r,color:"red",className:V(t.isSubmitting&&"!cursor-progress"),leftSection:e.jsx(ie,{className:"aspect-square w-4"}),children:s(f.DELETE)}):null})]})},os=()=>{var C;const{watch:t}=v(),s=t(),{t:a}=j(),{itemData:n,currentView:l,setLanguage:o,language:c}=O(),i=E(),u=Pe(),{setValue:m,formState:r}=v(),x=p.useMemo(()=>l==="update"?!!Object.keys(Re(n||{},s)).length:!0,[s,l,n]),g=()=>{l==="create"&&m("published",!0)},y=p.useMemo(()=>{let d="";return l==="create"?r.isSubmitting?d="Publishing":d="Publish":l==="update"&&(r.isSubmitting?d="Updating":d="Update"),a(d)},[l,r.isSubmitting,a]),R=p.useMemo(()=>{let d="";if(!(i!=null&&i.draftable))return d;if(l==="create")r.isSubmitting?d="Saving":d="Save as concept";else if(l==="update"){if(!n)return d;n.published?d="Unpublish":d="Publish"}return a(d)},[l,r.isSubmitting,i,n,a]),_=()=>{m("published",n?!n.published:!1)},S=p.useMemo(()=>i==null?void 0:i.columns.filter(d=>d.localized),[i]);return e.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between px-5 rounded-prom bg-transparent",children:[e.jsx("div",{className:"flex gap-3 justify-center"}),e.jsxs("div",{className:"flex items-center gap-3",children:[(i==null?void 0:i.draftable)&&e.jsx(F,{size:"sm",variant:"transparent",type:"submit",disabled:r.isSubmitting,className:"ml-auto",onClick:_,px:"sm",children:R}),e.jsx(F,{size:"lg",color:"green",type:"submit",disabled:!x,loading:r.isSubmitting,onClick:g,children:y}),(((C=u.application)==null?void 0:C.i18n.languages.length)??0)>1&&(S!=null&&S.length)&&l==="update"?e.jsx(Ve,{language:c??"",onSelect:o}):null,e.jsx(ls,{})]})]})},fs=({viewType:t})=>{const s=E(),a=p.useMemo(()=>{if(s)return re(s,I.ASIDE)},[s]);return e.jsx(Le,{viewType:t,children:e.jsx(Be.Consumer,{children:({onSubmit:n})=>e.jsx("form",{autoComplete:"off",onSubmit:n,className:"h-full",children:e.jsxs(Ue,{rightAsideOutlet:s&&(s!=null&&s.timestamp&&(s!=null&&s.ownable)||a!=null&&a.length||s!=null&&s.sharable)?e.jsxs(Fe,{isOpen:!0,children:[s!=null&&s.timestamp&&(s!=null&&s.ownable)?e.jsx(as,{}):null,a!=null&&a.length?e.jsx(Qe,{model:s}):null,(s==null?void 0:s.sharable)&&e.jsx(ts,{})]}):void 0,children:[e.jsx(os,{}),e.jsx(Me,{children:e.jsxs(He,{children:[e.jsx(ns,{}),e.jsx(ze,{modelInfo:s})]})})]})})})})};export{fs as E};
