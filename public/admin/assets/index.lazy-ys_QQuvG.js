import{s as E,z as a,M as s,aN as h,h as R,b as _,u as x,r as D,j as r,c as N,d,B as b,e as j,f as C,aK as O,g as I}from"./index-cac_S5g_.js";import{t as W}from"./toastedPromise-LzwZMqyf.js";import{D as L}from"./Drawer-g9Y-9ZlZ.js";import"./NativeScrollArea-Q3mUJQz_.js";import"./Overlay-RVC-BiIf.js";const y=E(a.object({newPassword:a.string({required_error:s.FIELD_REQUIRED}).min(6,h("Too short, minimum 6 characters")),newPasswordAgain:a.string(),oldPassword:a.string({required_error:s.FIELD_REQUIRED})}).superRefine((o,t)=>{o.newPassword!==o.newPasswordAgain&&t.addIssue({code:a.ZodIssueCode.custom,message:s.PASSWORDS_MUST_MATCH})})),M=()=>{var m,c,w;const o=R(),t=_({resolver:y}),{t:e}=x(),{handleSubmit:p,formState:i,register:l,setError:S}=t,P=D.useCallback(()=>{o({to:"/settings/profile"})},[o]),A=async u=>{var g;if(confirm(e(s.ARE_YOUR_REALLY_SURE)))try{await W({title:e(s.CHANGE_PASSWORD),message:e(s.PLEASE_WAIT),successMessage:e(s.PASSWORD_CHANGE_DONE)},async()=>{await j.profile.changePassword(u.newPassword,u.oldPassword)}),o({to:"/logout"})}catch(n){if(C.isAxiosError(n)&&O(n.response)){const{code:f}=(g=n.response)==null?void 0:g.data;f==="old-password-invalid"&&S("oldPassword",{message:s.INVALID_OLD_PASSWORD})}throw n}};return r.jsx(L,{opened:!0,onClose:P,padding:32,size:"xl",position:"right",className:"overflow-auto",title:e(s.CHANGE_PASSWORD),children:r.jsx(N,{...t,children:r.jsxs("form",{className:"h-full",onSubmit:p(A),children:[r.jsxs("div",{className:"grid w-full max-w-lg gap-4",children:[r.jsx(d,{label:e(s.OLD_PASSWORD),className:"w-full",error:e(((m=i.errors.oldPassword)==null?void 0:m.message)??""),autoComplete:"current-password",...l("oldPassword")}),r.jsx("hr",{className:"bg-gray-200 border-none h-0.5 w-full my-0"}),r.jsx(d,{label:e(s.NEW_PASSWORD),className:"w-full",error:e(((c=i.errors.newPassword)==null?void 0:c.message)??""),autoComplete:"new-password",...l("newPassword")}),r.jsx(d,{label:e(s.NEW_PASSWORD_AGAIN),className:"w-full",error:e(((w=i.errors.newPasswordAgain)==null?void 0:w.message)??""),autoComplete:"off",...l("newPasswordAgain")})]}),r.jsx(b,{loading:i.isSubmitting,type:"submit",className:"mt-5",children:e(s.SAVE)})]})})})},z=I("/_authorized/settings/profile/password/change/")({component:()=>r.jsx(M,{})});export{z as Route};
