import{r as d,c as L,f as z,$ as q,m as V,n as W,u as k,M as b,h as I,s as h,a0 as B,j as l,N as F,P as G,o as Q,a1 as Y}from"./index-lKkbEZXj.js";import{f as $,T as y}from"./_utils-0wHRticH.js";var H=Object.defineProperty,J=Object.defineProperties,K=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,M=(c,r,a)=>r in c?H(c,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[r]=a,Z=(c,r)=>{for(var a in r||(r={}))U.call(r,a)&&M(c,a,r[a]);if(O)for(var a of O(r))X.call(r,a)&&M(c,a,r[a]);return c},ee=(c,r)=>J(c,K(r));function te(c=[]){const[r,a]=d.useState(c);return[r,{setState:a,append:(...t)=>a(s=>[...s,...t]),prepend:(...t)=>a(s=>[...t,...s]),insert:(t,...s)=>a(i=>[...i.slice(0,t),...s,...i.slice(t)]),pop:()=>a(t=>{const s=[...t];return s.pop(),s}),shift:()=>a(t=>{const s=[...t];return s.shift(),s}),apply:t=>a(s=>s.map((i,n)=>t(i,n))),applyWhere:(t,s)=>a(i=>i.map((n,m)=>t(n,m)?s(n,m):n)),remove:(...t)=>a(s=>s.filter((i,n)=>!t.includes(n))),reorder:({from:t,to:s})=>a(i=>{const n=[...i],m=i[t];return n.splice(t,1),n.splice(s,0,m),n}),setItem:(t,s)=>a(i=>{const n=[...i];return n[t]=s,n}),setItemProp:(t,s,i)=>a(n=>{const m=[...n];return m[t]=ee(Z({},m[t]),{[s]:i}),m}),filter:t=>{a(s=>s.filter(t))}}]}const ne=({})=>{const c=L(),{modelId:r}=z(),[a,x]=d.useState(1),[P,E]=d.useState(20),e=q(),u=V(),[j,_]=d.useState(!1),{data:o,isLoading:v,isError:w,refetch:T}=W(e==null?void 0:e.name,{params:{page:a,limit:P,...e!=null&&e.timestamp?{"orderBy.created_at":"desc"}:{}}}),{t:g}=k(),[t,s]=te(o==null?void 0:o.data);d.useEffect(()=>{o!=null&&o.data&&s.setState(o==null?void 0:o.data)},[o]);const i=d.useMemo(()=>{if(!o)return!1;const{data:p,...f}=o;return f},[o]),n=async({source:p,destination:f})=>{if((f==null?void 0:f.index)===void 0)return;_(!0);const N=t[p.index].id,S=t[f.index].id;N!==S&&(s.reorder({from:p.index,to:f.index}),await I.entries.for(e.name).swap({fromId:N,toId:S})),_(!1)},m=d.useMemo(()=>{if(e)return $(e)},[e]),C=e&&(u!=null&&u.can({action:"delete",targetEntityTableName:e==null?void 0:e.name}))?async p=>{confirm(g(b.ON_DELETE_REQUEST_PROMPT))&&(await I.entries.for(e.name).delete(p),T())}:void 0,D=e&&(u!=null&&u.can({action:"create",targetEntityTableName:e==null?void 0:e.name}))?async p=>{confirm(g(b.ENTRY_ITEM_DUPLICATE))&&c(h.entryTypes(e==null?void 0:e.name).duplicate(p))}:void 0,R=()=>c(h.entryTypes(e==null?void 0:e.name).create),A=p=>c(h.entryTypes(e==null?void 0:e.name).view(p));return d.useEffect(()=>x(1),[r]),!e||!m||B(e.name)?l.jsx(F,{text:g("This model with this id does not exist.")}):l.jsxs(G,{children:[l.jsxs("div",{className:"flex w-full flex-col justify-between gap-5 py-10 md:flex-row",children:[l.jsx("h1",{className:"text-3xl font-semibold capitalize",children:g(e.title??e.name)}),l.jsx("div",{className:"flex items-center gap-5",children:(u==null?void 0:u.can({action:"create",targetEntityTableName:e.name}))&&l.jsxs(Q,{color:"green",className:" items-center font-semibold uppercase",size:"md",onClick:R,children:[l.jsx("span",{className:"hidden md:block",children:g("Add new entry")}),l.jsx(Y,{className:"inline-block h-5 w-5 md:ml-3"})," "]})})]}),l.jsx(y,{isLoading:v||w,items:t,columns:m,onEditAction:A,onDeleteAction:C,onDuplicateAction:D,ordering:!!e.sorting,onDragEnd:n,disabled:j}),l.jsxs(y.Footer,{children:[l.jsx(y.PageSizeSelect,{value:String(P),onChange:p=>{E(p?Number(p):20)}}),i&&l.jsx(y.Metadata,{className:"mr-auto ml-5",...i}),l.jsx(y.Pagination,{className:"ml-auto",total:(o==null?void 0:o.last_page)||1,page:a,onChange:x})]})]})};export{ne as default};
