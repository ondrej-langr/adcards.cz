import{aO as G,r as a,aP as B,a as $,aJ as J,e as A,a1 as V,s as X,aQ as R,u as w,b as Y,E as H,f as Z,aR as K,j as t,c as ee,H as te,D,B as _,aS as y,a8 as se,M as O,A as ne,w as L,aT as oe,T as ae,h as ie,o as re}from"./index-UkeQhmow.js";import{H as k,L as le,W as ce,C as ue,D as de}from"./LanguageMutation-rU1IZZ2b.js";import{g as me,a as ge,E as pe}from"./prepareFieldsForMapper-qzIJNNy9.js";import"./ImageSelect-OrQni5Eo.js";import"./mustache-hdmEeTIN.js";import"./FileList-oh-Khnf6.js";import"./LanguageSelect-Jej8Jmsy.js";import{t as U}from"./toastedPromise-SlM3n6Md.js";import"./Divider-FzsehbAm.js";import"./Table-suaNUuwQ.js";import"./ScrollArea-n1YaU9Cl.js";import"./Textarea-mbbkmEOn.js";import"./extends-qemKJW_u.js";import"./useRequestWithNotifications-UP2luH2G.js";import"./Select-3J8J3tZj.js";import"./Skeleton-VlALSyZX.js";import"./Repeater-BGo_k1Uh.js";import"./useModelItems-1E8lchLJ.js";import"./NativeScrollArea-beAZtOJ3.js";import"./Overlay-P14s14uU.js";import"./Modal-0L1jbVT5.js";import"./ItemsMissingMessage-SzV8FphL.js";import"./get-auto-contrast-value-TBhcg1GA.js";const fe=s=>{const{singletons:n}=G();return a.useMemo(()=>n&&n[s],[s,n])};console.log({SingletonUnderpageRoute:B});const f=(s=!1)=>{const{singletonId:n}=$({from:B.id}),e=a.useMemo(()=>String(n),[n]),o=fe(e);if(s&&!o)throw new Error("Model not found");return a.useMemo(()=>o?{...o,key:e}:void 0,[e,o])};function he({queryKey:s}){return A.singletons.for(s[0]).get(s[1]).then(({data:n})=>n.data)}function z(s,n){const e=f(!0);return J([e.key,s],he,n)}z.refetch=()=>{};const q=a.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),Q=()=>a.useContext(q),xe=({children:s})=>{var c,F;const n=V(),e=f(!0),o=a.useMemo(()=>{if(!e)return;const P=me(e,!0);return async(b,S,j)=>{const u=await X(P)(b,S,j);return R.warning("Validating form:"),R.warning({data:b,result:u}),u}},[e]),{t:r}=w(),[i,l]=a.useState((F=(c=n.application)==null?void 0:c.i18n)==null?void 0:F.default),{data:d,isLoading:C,refetch:m}=z({language:i},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),g=Y({defaultValues:ge(e,d??{}),reValidateMode:"onChange",mode:"onTouched",resolver:o}),{handleSubmit:M,setError:T}=g;a.useEffect(()=>{d&&g.reset(d)},[d,g.reset]);const E=M(async P=>{var S,j;const b=e.key;try{await U({title:"Updating",message:r("Updating, please wait..."),successMessage:r("Your entry is updated!")},async()=>{const u=H(d,P);await A.singletons.for(b).update(u,{language:i}),await m()})}catch(u){if(Z.isAxiosError(u)&&K(u.response)&&((S=u.response.headers["content-description"])!=null&&S.includes(String(pe)))){const v=u.response.data.data;if(Array.isArray(v)&&v.length)for(const N of v){const p=(j=e==null?void 0:e.columns)==null?void 0:j.find(W=>W.name===N);if(!p)continue;let I=N;N==="slug"&&(p==null?void 0:p.type)==="slug"&&(I=p.of),T(I,{message:r("This field is unique and other entry has the same value")})}}}}),h=a.useCallback(async()=>U({message:r("Clearing singleton..."),title:r("Clearing"),errorMessage:r("Failed to clear"),successMessage:r("Clearing successful!")},async()=>{await A.singletons.for(e==null?void 0:e.key).clear(),await m()}),[e,r,g.reset]),x=a.useMemo(()=>({language:i,setLanguage:l,data:d,isLoading:C,clear:h}),[i,l,h]);return t.jsx(ee,{...g,children:t.jsx(q.Provider,{value:x,children:t.jsx("form",{onSubmit:E,children:s})})})},be=()=>{const{name:s,title:n,columns:e}=f(!0),{t:o}=w();return a.useMemo(()=>e&&!!e.find(i=>!i.hide&&i.admin.editor.placement===te.MAIN&&i.type==="string"&&i.admin.fieldType==="heading"),[e])?null:t.jsxs(k,{children:[t.jsxs(k.Title,{children:[o("Update")," ",n||s]}),t.jsx(k.Divider,{})]})},Se=()=>{const{formState:s,reset:n}=D(),{t:e}=w(),{clear:o}=Q(),[r,i]=a.useState(!1),l=async()=>{confirm(e(O.ON_DELETE_REQUEST_PROMPT))&&(await o(),n())};return t.jsxs(y,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>i(!0),onClose:()=>i(!1),children:[t.jsx(y.Target,{children:t.jsx(se,{withArrow:!0,label:e(O.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:r,children:t.jsx(ne,{size:"xl",color:"gray",variant:"light",type:"button",className:L(s.isSubmitting&&"!cursor-progress"),loading:s.isSubmitting,styles:{root:{width:50,height:50}},children:t.jsx(oe,{className:"aspect-square w-20 duration-150"})})})}),t.jsx(y.Dropdown,{children:t.jsx(y.Item,{type:"button",onClick:l,color:"red",className:L(s.isSubmitting&&"!cursor-progress"),leftSection:t.jsx(ae,{className:"aspect-square w-4"}),children:e(O.PURGE_DATA)})})]})},je=()=>{var x;const{watch:s}=D(),n=s(),{t:e}=w(),{data:o,setLanguage:r,language:i}=Q(),l=f(),d=V(),{setValue:C,formState:m}=D(),g=a.useMemo(()=>!!Object.keys(H(o||{},n)).length,[n,o]),M=()=>{},T=a.useMemo(()=>{let c="";return m.isSubmitting?c="Updating":c="Update",e(c)},[m.isSubmitting,e]),E=a.useMemo(()=>{let c="";return!(l!=null&&l.draftable)||!o?c:(o.is_published?c="Unpublish":c="Publish",e(c))},[o,m.isSubmitting,l,e]),h=()=>{C("is_published",o?!o.is_published:!1)};return t.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-end gap-2 px-5 rounded-prom bg-transparent",children:[(l==null?void 0:l.draftable)&&t.jsx(_,{size:"sm",variant:"transparent",type:"submit",disabled:m.isSubmitting,className:"ml-auto",onClick:h,px:"sm",children:E}),t.jsx(_,{size:"lg",color:"green",type:"submit",disabled:!g,loading:m.isSubmitting,onClick:M,children:T}),(((x=d.application)==null?void 0:x.i18n.languages.length)??0)>1?t.jsx(le,{language:i??"",onSelect:r}):null,t.jsx(Se,{})]})},We=ie("/_authorized/entities/singletons/$singletonId/")({component:we}),ye=()=>{const s=f(!0);return t.jsx(de,{modelInfo:s})};function we(){return t.jsx(xe,{children:t.jsxs(re,{rightAsideOutlet:!0,children:[t.jsx(je,{}),t.jsx(ce,{children:t.jsxs(ue,{children:[t.jsx(be,{}),t.jsx(ye,{})]})})]})})}export{We as Route};
