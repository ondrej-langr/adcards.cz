import{aO as je,J as ae,R as y,aP as A,aQ as Ee,I as Ne,N as Se,Z as ye,aR as we,r as h,Y as ne,u as j,H as _,j as e,M as u,e as le,_ as Oe,l as D,D as w,A as ie,T as oe,a9 as z,aS as k,B as F,p as Te,ay as ve,an as O,aT as ee,w as V,y as Ce,L as Ae,x as _e,a8 as De,E as Ie,aL as C,ad as Pe,aM as Re,o as Le}from"./index-cac_S5g_.js";import{p as re,F as Ue,b as T,d as ke,e as Be}from"./prepareFieldsForMapper-TTpMTl2W.js";import"./ImageSelect-foRB89a-.js";import{u as ce}from"./useModelItems-yWM5Ht52.js";import"./FileList-wbIKmOFD.js";import{A as Y}from"./AsideItemWrap-dIrvBNCH.js";import{A as Fe}from"./AsideWrapper-qiE2yjNM.js";import{H as B,L as Ve,W as Me,C as He,D as ze}from"./LanguageMutation-TpqP0h5i.js";import{S as N}from"./Skeleton-eoevnRmQ.js";import{g as Ye,a as We,u as $e,C as M,O as qe}from"./Select-ZUVIaLDV.js";var de={root:"m-849cf0da"};const Ke={underline:"hover"},W=je((t,s)=>{const{underline:a,className:n,unstyled:l,mod:i,...c}=ae("Anchor",Ke,t);return y.createElement(A,{component:"a",ref:s,className:Ee({[de.root]:!l},n),...c,mod:[{underline:a},i],__staticSelector:"Anchor",unstyled:l})});W.classes=de;W.displayName="@mantine/core/Anchor";const Qe={},$=Ne((t,s)=>{const a=ae("Autocomplete",Qe,t),{classNames:n,styles:l,unstyled:i,vars:c,dropdownOpened:o,defaultDropdownOpened:m,onDropdownClose:p,onDropdownOpen:r,onFocus:g,onBlur:b,onClick:E,onChange:I,data:P,value:S,defaultValue:v,selectFirstOptionOnChange:d,onOptionSubmit:R,comboboxProps:ue,readOnly:L,disabled:q,filter:me,limit:pe,withScrollArea:he,maxDropdownHeight:xe,size:K,id:ge,...be}=a,Q=Se(ge),G=Ye(P),fe=We(G),[U,X]=ye({value:S,defaultValue:v,finalValue:"",onChange:I}),f=$e({opened:o,defaultOpened:m,onDropdownOpen:r,onDropdownClose:()=>{p==null||p(),f.resetSelectedOption()}}),{resolvedClassNames:J,resolvedStyles:Z}=we({props:a,styles:l,classNames:n});return h.useEffect(()=>{d&&f.selectFirstOption()},[d,U]),y.createElement(M,{store:f,__staticSelector:"Autocomplete",classNames:J,styles:Z,unstyled:i,readOnly:L,onOptionSubmit:x=>{R==null||R(x),X(fe[x].label),f.closeDropdown()},size:K,...ue},y.createElement(M.Target,null,y.createElement(ne,{ref:s,...be,size:K,__staticSelector:"Autocomplete",disabled:q,readOnly:L,value:U,onChange:x=>{X(x.currentTarget.value),f.openDropdown(),d&&f.selectFirstOption()},onFocus:x=>{f.openDropdown(),g==null||g(x)},onBlur:x=>{f.closeDropdown(),b==null||b(x)},onClick:x=>{f.openDropdown(),E==null||E(x)},classNames:J,styles:Z,unstyled:i,id:Q})),y.createElement(qe,{data:G,hidden:L||q,filter:me,search:U,limit:pe,hiddenWhenEmpty:!0,withScrollArea:he,maxDropdownHeight:xe,unstyled:i,labelId:`${Q}-label`}))});$.classes={...ne.classes,...M.classes};$.displayName="@mantine/core/Autocomplete";const Ge=({model:t})=>{const{t:s}=j(),a=h.useMemo(()=>{if(t)return re(t,_.ASIDE)},[t]);return a&&a.length?e.jsx(Y,{title:s(u.OTHER_INFO),children:e.jsx("div",{className:"mb-5 flex flex-wrap gap-y-5 items-baseline p-2",children:e.jsx(Ue,{type:_.ASIDE,fields:a})})}):null},Xe=(t,s,a)=>{const n=h.useCallback(()=>le.userRoles.getOne(t,s).then(({data:l})=>l.data),[t,s]);return Oe([D.USER_ROLES,s],n,{enabled:!!t,...a})};h.forwardRef(function({avatar:s,email:a,id:n,name:l,password:i,role:c,state:o,...m},p){const{data:r,isLoading:g}=Xe(typeof c=="string"?c:c==null?void 0:c.id);return e.jsxs("div",{ref:p,...m,children:[e.jsx(A,{children:l}),e.jsx(A,{size:"xs",color:"blue",children:!r||g?e.jsx(N,{width:100,height:20}):r.label})]})});const Je=({withLabel:t=!0,...s})=>{const{t:a}=j(),{data:n}=ce(D.USERS,{params:{limit:5,where:{...s.value&&Number.isNaN(Number(s.value))?{name:{manipulator:"LIKE",value:`%${s.value}%`}}:{},...s.value&&!Number.isNaN(Number(s.value))?{id:{manipulator:"LIKE",value:s.value}}:{}}}},{enabled:!!s.value});return e.jsx($,{label:t?a(u.USER):void 0,placeholder:a(u.PLACEHOLDER_AUTOCOMPLETE),...s,data:((n==null?void 0:n.data)||[]).map(l=>({...l,value:String(l.name)}))})},Ze=e.jsxs(e.Fragment,{children:[e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30})]}),es=({id:t,name:s,onItemDelete:a})=>e.jsxs("div",{className:"flex justify-between rounded-lg bg-gray-50 px-4 py-2",children:[e.jsx(A,{size:"lg",children:s}),e.jsx(ie,{color:"red",variant:"light",onClick:()=>a(t),children:e.jsx(oe,{width:20,height:20})})]}),ss=()=>{const{watch:t,setValue:s,getValues:a}=w(),n=t("coeditors"),l=!Object.keys(n||{}).length,{data:i,isLoading:c}=ce(D.USERS,{params:{limit:999,where:{id:{manipulator:"IN",value:Object.keys(n||{})}}}},{enabled:!l}),o=h.useCallback(m=>{const p="coeditors",{...r}=a(p);delete r[m],s(p,r)},[s,a]);return!c||l?e.jsx(e.Fragment,{children:((i==null?void 0:i.data)||[]).map(m=>e.jsx(es,{onItemDelete:o,...m},m.id))}):Ze},ts=()=>{const{itemData:t}=T(),s=z(),[a,n]=h.useState(!1),[l,i]=h.useState(),[c,o]=h.useState(!1),{setValue:m,getValues:p}=w(),{t:r}=j(),g=h.useCallback(({id:b})=>{n(!0);const E=p("coeditors")??{};m("coeditors",{...E,[String(b)]:!0}),n(!1),o(!1),i("")},[p,m]);return!(s!=null&&s.can({action:"update",targetEntityTableName:D.USER_ROLES}))&&(s==null?void 0:s.id)!==(t==null?void 0:t.created_by)?null:e.jsx(e.Fragment,{children:e.jsx(Y,{title:r(u.CONTRIBUTORS),description:r(u.ADD_CONTRIBUTOR_TEXT),children:e.jsxs("div",{className:"grid grid-cols-1 gap-2.5 p-2.5",children:[e.jsx(ss,{}),e.jsxs(k,{closeOnClickOutside:!1,closeOnEscape:!1,opened:c,onClose:()=>o(!1),position:"bottom",transitionProps:{transition:"pop-top-right"},width:400,children:[e.jsx(k.Target,{children:e.jsx(F,{className:"w-full",leftSection:e.jsx(Te,{className:"h-7 w-7"}),variant:"light",type:"button",onClick:()=>o(b=>!b),children:e.jsx("span",{className:"ml-auto inline-block",children:r(u.ADD_CONTRIBUTOR)})})}),e.jsxs(k.Dropdown,{className:"w-full",title:r(u.SELECT_USER_PLACEHOLDER),children:[e.jsx(Je,{withLabel:!1,disabled:a,value:l,onChange:i,onItemSubmit:g}),e.jsx(ve,{justify:"space-between",style:{marginTop:15},children:e.jsx(W,{component:"button",color:"gray",size:"sm",disabled:a,onClick:()=>o(!1),children:r(u.CANCEL_ACTION)})})]})]})]})})})},H=({className:t,...s})=>e.jsx(N,{className:V("relative top-0.5 inline-block h-4",t),...s}),se=({id:t,name:s})=>{const{t:a}=j(),{data:n,isLoading:l}=Ce(t,{enabled:!!t&&!s}),i=z(),c=(n==null?void 0:n.name)??s,o=Number(t)===Number(i==null?void 0:i.id)||c===(i==null?void 0:i.name);return l&&!s||!c||!t?e.jsx(H,{className:"inline-block"}):e.jsx(Ae,{to:o?"/settings/profile":_e.users.view(t),className:"font-semibold text-blue-600",children:o?a(u.ME):c})},te="D.M. YYYY, HH:mm",as=()=>{const{itemData:t,itemIsLoading:s}=T(),{t:a}=j(),n=O();return e.jsx(Y,{className:"!pt-0",title:a(u.PUBLISH_INFO),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[(n==null?void 0:n.timestamp)&&e.jsxs(e.Fragment,{children:[!!(t!=null&&t.updatedAt)&&e.jsxs("li",{children:[a(u.UPDATED_AT),":"," ",s?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(t.updatedAt).format(te)})]}),!!(t!=null&&t.createdAt)&&e.jsxs("li",{children:[a(u.CREATED_AT),":"," ",s?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(t.createdAt).format(te)})]})]}),(n==null?void 0:n.ownable)&&e.jsxs(e.Fragment,{children:[t!=null&&t.updatedBy?e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a(u.UPDATED_BY),":"]})," ",e.jsx(se,{...t.updatedBy})]})}):null,t!=null&&t.createdBy?e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a(u.CREATED_BY),":"]})," ",e.jsx(se,{...t.createdBy})]})}):null]})]})})})},ns=()=>{const{currentView:t}=T(),s=O(),{t:a}=j();return h.useMemo(()=>(s==null?void 0:s.columns)&&!!(s!=null&&s.columns.find(l=>!l.hide&&l.admin.editor.placement===_.MAIN&&l.type==="string"&&l.admin.fieldType==="heading")),[s])?null:e.jsxs(B,{children:[e.jsx(B.Title,{children:a(t=="update"?"Update an entry":"Create an entry")}),e.jsx(B.Divider,{})]})},ls=()=>{const{formState:t}=w(),{t:s}=j(),{itemData:a,currentView:n,exitView:l}=T(),i=O(),c=z(),[o,m]=h.useState(!1),p=n==="update"&&i&&(c==null?void 0:c.can({action:"create",targetEntityTableName:i==null?void 0:i.name})),r=async()=>{confirm(s(u.ON_DELETE_REQUEST_PROMPT))&&(l(),await le.entries.for(i==null?void 0:i.name).delete(a==null?void 0:a.id))};return e.jsxs(C,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>m(!0),onClose:()=>m(!1),children:[e.jsx(C.Target,{children:e.jsx(Pe,{withArrow:!0,label:s(u.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:o,children:e.jsx(ie,{size:"xl",color:"gray",variant:"light",type:"button",className:V(t.isSubmitting&&"!cursor-progress"),loading:t.isSubmitting,styles:{root:{width:50,height:50}},children:e.jsx(Re,{className:"aspect-square w-20 duration-150"})})})}),e.jsx(C.Dropdown,{children:p?e.jsx(C.Item,{type:"button",onClick:r,color:"red",className:V(t.isSubmitting&&"!cursor-progress"),leftSection:e.jsx(oe,{className:"aspect-square w-4"}),children:s(u.DELETE)}):null})]})},is=()=>{var v;const{watch:t}=w(),s=t(),{t:a}=j(),{itemData:n,currentView:l,setLanguage:i,language:c}=T(),o=O(),m=De(),{setValue:p,formState:r}=w(),g=h.useMemo(()=>l==="update"?!!Object.keys(Ie(n||{},s)).length:!0,[s,l,n]),b=()=>{l==="create"&&p("published",!0)},E=h.useMemo(()=>{let d="";return l==="create"?r.isSubmitting?d="Publishing":d="Publish":l==="update"&&(r.isSubmitting?d="Updating":d="Update"),a(d)},[l,r.isSubmitting,a]),I=h.useMemo(()=>{let d="";if(!(o!=null&&o.draftable))return d;if(l==="create")r.isSubmitting?d="Saving":d="Save as concept";else if(l==="update"){if(!n)return d;n.published?d="Unpublish":d="Publish"}return a(d)},[l,r.isSubmitting,o,n,a]),P=()=>{p("published",n?!n.published:!1)},S=h.useMemo(()=>o==null?void 0:o.columns.filter(d=>d.localized),[o]);return e.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between px-5 rounded-prom bg-transparent",children:[e.jsx("div",{className:"flex gap-3 justify-center"}),e.jsxs("div",{className:"flex items-center gap-3",children:[(o==null?void 0:o.draftable)&&e.jsx(F,{size:"sm",variant:"transparent",type:"submit",disabled:r.isSubmitting,className:"ml-auto",onClick:P,px:"sm",children:I}),e.jsx(F,{size:"lg",color:"green",type:"submit",disabled:!g,loading:r.isSubmitting,onClick:b,children:E}),(((v=m.application)==null?void 0:v.i18n.languages.length)??0)>1&&(S!=null&&S.length)&&l==="update"?e.jsx(Ve,{language:c??"",onSelect:i}):null,e.jsx(ls,{})]})]})},bs=({viewType:t})=>{const s=O(),a=h.useMemo(()=>{if(s)return re(s,_.ASIDE)},[s]);return e.jsx(ke,{viewType:t,children:e.jsx(Be.Consumer,{children:({onSubmit:n})=>e.jsx("form",{autoComplete:"off",onSubmit:n,className:"h-full",children:e.jsxs(Le,{rightAsideOutlet:s&&(s!=null&&s.timestamp&&(s!=null&&s.ownable)||a!=null&&a.length||s!=null&&s.sharable)?e.jsxs(Fe,{isOpen:!0,children:[s!=null&&s.timestamp&&(s!=null&&s.ownable)?e.jsx(as,{}):null,a!=null&&a.length?e.jsx(Ge,{model:s}):null,(s==null?void 0:s.sharable)&&e.jsx(ts,{})]}):void 0,children:[e.jsx(is,{}),e.jsx(Me,{children:e.jsxs(He,{children:[e.jsx(ns,{}),e.jsx(ze,{modelInfo:s})]})})]})})})})};export{bs as E};
