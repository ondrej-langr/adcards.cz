import{r as p,g as D,h as z,an as L,a9 as W,u as q,M as N,e as A,x as S,ao as B,j as r,o as T,B as F,p as k,A as V}from"./index-cac_S5g_.js";import{T as g}from"./TableView-DVWNDnUU.js";import{f as G}from"./_utils-UdYZV02l.js";import{u as O}from"./useModelItems-yWM5Ht52.js";import"./ItemsMissingMessage-WP2Z8gMA.js";import"./Skeleton-eoevnRmQ.js";import"./use-disclosure--_1CWTEj.js";import"./Drawer-g9Y-9ZlZ.js";import"./NativeScrollArea-Q3mUJQz_.js";import"./Overlay-RVC-BiIf.js";import"./Select-ZUVIaLDV.js";function H(d=[]){const[E,o]=p.useState(d);return[E,{setState:o,append:(...t)=>o(s=>[...s,...t]),prepend:(...t)=>o(s=>[...t,...s]),insert:(t,...s)=>o(a=>[...a.slice(0,t),...s,...a.slice(t)]),pop:()=>o(t=>{const s=[...t];return s.pop(),s}),shift:()=>o(t=>{const s=[...t];return s.shift(),s}),apply:t=>o(s=>s.map((a,n)=>t(a,n))),applyWhere:(t,s)=>o(a=>a.map((n,c)=>t(n,c)?s(n,c):n)),remove:(...t)=>o(s=>s.filter((a,n)=>!t.includes(n))),reorder:({from:t,to:s})=>o(a=>{const n=[...a],c=a[t];return n.splice(t,1),n.splice(s,0,c),n}),swap:({from:t,to:s})=>o(a=>{const n=[...a],c=n[t],x=n[s];return n.splice(s,1,c),n.splice(t,1,x),n}),setItem:(t,s)=>o(a=>{const n=[...a];return n[t]=s,n}),setItemProp:(t,s,a)=>o(n=>{const c=[...n];return c[t]={...c[t],[s]:a},c}),filter:t=>{o(s=>s.filter(t))}}]}const ae=D("/_authorized/entities/$modelId/")({component:Q});function Q(){const d=z(),[E,o]=p.useState(1),[y,b]=p.useState(20),e=L(),m=W(),[w,I]=p.useState(!1),{data:i,isLoading:C,isError:P,refetch:R}=O(e==null?void 0:e.name,{params:{page:E,limit:y,...e!=null&&e.timestamp?{"orderBy.created_at":"desc"}:{}}}),{t:f}=q(),[h,j]=H(i==null?void 0:i.data);p.useEffect(()=>{i!=null&&i.data&&j.setState(i==null?void 0:i.data)},[i]);const t=p.useMemo(()=>{if(!i)return!1;const{data:l,...u}=i;return u},[i]),s=async({source:l,destination:u})=>{if((u==null?void 0:u.index)===void 0)return;I(!0);const M=h[l.index].id,_=h[u.index].id;M!==_&&(j.reorder({from:l.index,to:u.index}),await A.entries.for(e.name).swap({fromId:M,toId:_})),I(!1)},a=p.useMemo(()=>{if(e)return G(e)},[e]),n=e&&(m!=null&&m.can({action:"delete",targetEntityTableName:e==null?void 0:e.name}))?async l=>{confirm(f(N.ON_DELETE_REQUEST_PROMPT))&&(await A.entries.for(e.name).delete(l),R())}:void 0,c=e&&(m!=null&&m.can({action:"create",targetEntityTableName:e==null?void 0:e.name}))?async l=>{confirm(f(N.ENTRY_ITEM_DUPLICATE))&&d({to:S.entryTypes(e==null?void 0:e.name).duplicate(l)})}:void 0,x=()=>d({to:S.entryTypes(e==null?void 0:e.name).create}),v=l=>d({to:S.entryTypes(e==null?void 0:e.name).view(l)});if(p.useEffect(()=>o(1),[e]),!e||!a||B(e.name))throw new Error("not found");return r.jsxs(T,{children:[r.jsx(T.Header,{classNames:{wrapper:"flex items-center justify-between"},title:f(e.title??e.name),children:(m==null?void 0:m.can({action:"create",targetEntityTableName:e.name}))&&r.jsxs(r.Fragment,{children:[r.jsx(F,{color:"green",className:"font-semibold uppercase hidden md:block",size:"md",onClick:x,leftSection:r.jsx(k,{className:"inline-block h-5 w-5"}),children:r.jsx("span",{className:"hidden md:block",children:f(N.ADD_NEW_GENERIC)})}),r.jsx(V,{color:"green",className:" block md:hidden",size:"xl",onClick:x,children:r.jsx(k,{className:"inline-block h-7 w-7"})})]})}),r.jsxs(T.Content,{children:[r.jsx(g,{isLoading:C||P,items:h,columns:a,onEditAction:v,onDeleteAction:n,onDuplicateAction:c,ordering:!!e.sorting,onDragEnd:s,disabled:w}),r.jsxs(g.Footer,{children:[r.jsx(g.PageSizeSelect,{value:String(y),onChange:l=>{b(l?Number(l):20)}}),t&&r.jsx(g.Metadata,{className:"mr-auto ml-5",...t}),r.jsx(g.Pagination,{className:"ml-auto",total:(i==null?void 0:i.last_page)||1,value:E,onChange:o})]})]})]})}export{ae as Route};
