import{aA as G,r,f as X,h as F,at as ee,aB as se,av as te,aC as ne,V as ae,aD as L,u as y,q as oe,R as re,aE as ie,aF as U,x as Q,w as le,aG as ce,aH as ue,j as e,Y as de,H as W,ax as me,aI as _,aa as ge,J as k,aJ as K,G as fe,aK as he,Z as xe,z as pe,aL as A,v as V,ai as be,e as z,A as H,K as je,o as R,aM as ye,M as we,N as Ne,aN as Ce,aO as Se,aP as ke}from"./index-lKkbEZXj.js";const ve=s=>{const{singletons:t}=G();return r.useMemo(()=>t&&t[s],[s,t])},h=(s=!1)=>{const{singletonId:t}=X(),n=r.useMemo(()=>String(t),[t]),a=ve(n);if(s&&!a)throw new Error("Model not found");return r.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},Me=(s,t)=>{const n=h(!0),a=r.useCallback(()=>F.singletons.for(n.key).get(s).then(({data:x})=>x.data),[n,s]),d=r.useMemo(()=>[n.key],[n.key]),o=ee([d,s],a,{...t});return r.useMemo(()=>({...o,key:d}),[d,o])},J=r.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),O=()=>r.useContext(J),Ee=({children:s})=>{var D;const t=se(),n=te(),a=h(!0),d=r.useMemo(()=>{if(!a)return;const c=ne(a,!0);return async(f,m,b)=>{const N=await ae(c)(f,m,b);return L.warning("Validating form:"),L.warning({data:f,result:N}),N}},[a]),{t:o}=y(),[x,g]=r.useState((D=n==null?void 0:n.i18n)==null?void 0:D.default),v=oe(),{data:i,isLoading:M,key:S}=Me({language:x},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),p=re({defaultValues:ie(a,i??{}),reValidateMode:"onChange",mode:"onTouched",resolver:d}),{handleSubmit:E,setError:P}=p,w=r.useCallback(c=>v.setQueryData(S,c),[S]);r.useEffect(()=>{var c;if(i&&(p.reset(i),t.refs.current))for(const[f,m]of Object.entries(t.refs.current))i[f]&&((c=m==null?void 0:m.blocks)==null||c.render(i[f]))},[i,p.reset]);const l=E(async c=>{var m,b,N;const f=a.key;if(t.refs.current)for(const[j,u]of Object.entries(t.refs.current))await(u==null?void 0:u.isReady),u&&"save"in u&&(c[j]=await u.save());try{await U({title:"Updating",message:o("Updating, please wait..."),successMessage:o("Your entry is updated!")},async()=>{const j=Q(i,c),{data:{data:u}}=await F.singletons.for(f).update(j,{language:x});w(u)})}catch(j){if(le.isAxiosError(j)&&ce(j.response)&&((b=(m=j.response)==null?void 0:m.data)==null?void 0:b.code)===ue){const u=j.response.data.data;if(Array.isArray(u)&&u.length)for(const I of u){const C=(N=a==null?void 0:a.columns)==null?void 0:N.find($=>$.name===I);if(!C)continue;let B=I;I==="slug"&&(C==null?void 0:C.type)==="slug"&&(B=C.of),P(B,{message:o("This field is unique and other entry has the same value")})}}}}),T=r.useCallback(async()=>U({message:o("Clearing singleton..."),title:o("Clearing"),errorMessage:o("Failed to clear"),successMessage:o("Clearing successful!")},async()=>{var f,m;const{data:{data:c}}=await F.singletons.for(a==null?void 0:a.key).clear();if(t.refs.current)for(const b of Object.values(t.refs.current))(m=b==null?void 0:(f=b.blocks).clear)==null||m.call(f);p.reset(c),w(c)}),[w,a,o,t,p.reset]),Z=r.useMemo(()=>({language:x,setLanguage:g,data:i,isLoading:M,clear:T}),[x,g,T]);return e.jsx(de,{...p,children:e.jsx(J.Provider,{value:Z,children:e.jsx("form",{className:"flex",onSubmit:l,children:s})})})},Pe=()=>{const{t:s}=y(),{language:t,setLanguage:n}=O(),{settings:a}=G();return((a==null?void 0:a.i18n.languages.length)??0)<=1?null:e.jsx(W,{title:s("Internationalization"),children:e.jsx("div",{className:"mx-5 mb-5",children:e.jsx(me,{value:t,onChange:d=>d&&n(d),className:"w-full",shadow:"xl"})})})},q=({className:s,...t})=>e.jsx(ge,{className:k("relative top-0.5 inline-block h-4",s),...t}),Y="D.M. YYYY, HH:mm",Ie=()=>{const{data:s,isLoading:t}=O(),{t:n}=y(),a=h();return a!=null&&a.timestamp?e.jsx(W,{className:"!pt-0",title:n("Publish info"),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[e.jsxs("li",{children:[n("Updated at:")," ",t?e.jsx(q,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?_(s.updated_at).format(Y):n("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[n("Created at:")," ",t?e.jsx(q,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:_(s.created_at).format(Y)})]})]})})}):null},Ae=()=>{const s=h(!0),{isOpen:t}=K();return e.jsxs(fe,{isOpen:t,children:[e.jsx(Ie,{}),e.jsx(Pe,{}),e.jsx(he,{model:s})]})},Fe=()=>{const{t:s}=y(),t=h(!0);return e.jsx(e.Fragment,{children:e.jsx(xe,{className:"py-5",items:[{content:s("Singletons")},{content:e.jsx("p",{className:"flex-none text-green-500 underline",children:t.title||t.name})}]})})},Oe=()=>{const{name:s,title:t,columns:n}=h(!0),{t:a}=y();return r.useMemo(()=>n&&!!n.find(o=>!o.hide&&o.admin.editor.placement===pe.MAIN&&o.type==="string"&&o.admin.fieldType==="heading"),[n])?null:e.jsxs(A,{children:[e.jsxs(A.Title,{children:[a("Update")," ",t||s]}),e.jsx(A.Divider,{})]})},Te=()=>{const{watch:s}=V(),t=s(),{t:n}=y(),{isOpen:a,setIsOpen:d}=K(),{data:o,clear:x}=O(),g=h(),{setValue:v,formState:i}=V(),M=r.useMemo(()=>!!Object.keys(Q(o||{},t)).length,[t,o]),S=async()=>{confirm(n(we.ON_DELETE_REQUEST_PROMPT))&&await x()},p=()=>{},E=r.useMemo(()=>{let l="";return i.isSubmitting?l="Updating":l="Update",n(l)},[i.isSubmitting,n]),P=r.useMemo(()=>{let l="";return!(g!=null&&g.draftable)||!o?l:(o.is_published?l="Unpublish":l="Publish",n(l))},[o,i.isSubmitting,g,n]),w=()=>{v("is_published",o?!o.is_published:!1)};return e.jsxs(be,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[e.jsx(z,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:e.jsx(H,{size:"xl",type:"button",loading:i.isSubmitting,onClick:S,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:k(i.isSubmitting&&"!cursor-progress"),children:e.jsx(je,{className:"aspect-square w-10"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[(g==null?void 0:g.draftable)&&e.jsx(R,{size:"sm",variant:"white",type:"submit",disabled:i.isSubmitting,className:"ml-auto",onClick:w,px:"sm",children:P}),e.jsx(R,{size:"lg",color:"green",type:"submit",disabled:!M,loading:i.isSubmitting,onClick:p,children:E}),e.jsx(z,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:e.jsx(H,{size:"xl",color:"blue",variant:"light",type:"button",className:k(i.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>d(l=>!l),children:e.jsx(ye,{className:k("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},De=()=>{const s=h(!0);return e.jsx(ke,{modelInfo:s})},Le=({})=>h()?e.jsxs(Ee,{children:[e.jsxs(Ce,{children:[e.jsx(Fe,{}),e.jsxs(Se,{children:[e.jsx(Oe,{}),e.jsx(De,{}),e.jsx(Te,{})]})]}),e.jsx(Ae,{})]}):e.jsx(Ne,{});export{Le as default};
