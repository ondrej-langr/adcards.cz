import{aG as Y,r as i,g as Z,i as A,aA as $,aH as ee,as as se,aI as te,Z as ne,aJ as L,Y as ae,aK as oe,u as y,q as re,aL as U,J,X as ie,aM as le,aN as ce,j as e,a1 as ue,L as W,aD as de,aO as B,ae as me,Q as v,aP as G,K as ge,aQ as fe,a2 as he,E as xe,aR as I,y as R,aj as pe,f as V,A as q,R as be,o as z,aS as je,M as ye,N as Ne,aT as Se,aU as we,aV as Ce}from"./index-2c8c6005.js";const ke=s=>{const{singletons:t}=Y();return i.useMemo(()=>t&&t[s],[s,t])},p=(s=!1)=>{const{singletonId:t}=Z(),n=i.useMemo(()=>String(t),[t]),a=ke(n);if(s&&!a)throw new Error("Model not found");return i.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},ve=(s,t)=>{const n=p(!0),a=i.useCallback(()=>A.singletons.getOne(n.key,s).then(({data:r})=>r.data),[n,s]),g=i.useMemo(()=>[n.key],[n.key]),o=$([g,s],a,{...t});return i.useMemo(()=>({...o,key:g}),[g,o])},K=i.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),T=()=>i.useContext(K),Me=({children:s})=>{var D;const t=ee(),n=se(),a=p(!0),g=i.useMemo(()=>{if(!a)return;const d=te(a,!0);return async(h,c,b)=>{const S=await ne(d)(h,c,b);return L.warning("Validating form:"),L.warning({data:h,result:S}),S}},[a]),o=ae({defaultValues:oe(a),reValidateMode:"onChange",mode:"onTouched",resolver:g}),{t:r}=y(),[u,w]=i.useState((D=n==null?void 0:n.i18n)==null?void 0:D.default),x=re(),{data:f,isLoading:M,key:C}=ve({language:u},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:O,setError:E}=o,N=i.useCallback(d=>x.setQueryData(C,d),[C]);i.useEffect(()=>{var d;if(f&&(o.reset({...Object.fromEntries(Object.entries(f).filter(([h,c])=>c!==null)),...f.content?{content:JSON.stringify(f.content)}:{}}),t.refs.current))for(const[h,c]of Object.entries(t.refs.current))f[h]&&((d=c==null?void 0:c.blocks)==null||d.render(f[h]))},[f,o]);const l=O(async d=>{var c,b,S;const h=a.key;if(t.refs.current)for(const[j,m]of Object.entries(t.refs.current))await(m==null?void 0:m.isReady),m&&"save"in m&&(d[j]=JSON.stringify(await m.save()));try{await U({title:"Updating",message:r("Updating, please wait..."),successMessage:r("Your entry is updated!")},async()=>{const j=J(f,d),{data:{data:m}}=await A.singletons.update(h,j,{language:u});N(m)})}catch(j){if(ie.isAxiosError(j)&&le(j.response)&&((b=(c=j.response)==null?void 0:c.data)==null?void 0:b.code)===ce){const m=j.response.data.data;if(Array.isArray(m)&&m.length)for(const P of m){const k=(S=a==null?void 0:a.columns)==null?void 0:S.get(P);let _=P;P==="slug"&&(k==null?void 0:k.type)==="slug"&&(_=k.of),E(_,{message:r("This field is unique and other entry has the same value")})}}}}),F=i.useCallback(async()=>U({message:r("Clearing singleton..."),title:r("Clearing"),errorMessage:r("Failed to clear"),successMessage:r("Clearing successful!")},async()=>{var h,c;const{data:{data:d}}=await A.singletons.clear(a==null?void 0:a.key);if(t.refs.current)for(const b of Object.values(t.refs.current))(c=b==null?void 0:(h=b.blocks).clear)==null||c.call(h);o.reset(d),N(d)}),[N,a,r,t,o.reset]),X=i.useMemo(()=>({language:u,setLanguage:w,data:f,isLoading:M,clear:F}),[u,w,F]);return e.jsx(ue,{...o,children:e.jsx(K.Provider,{value:X,children:e.jsx("form",{className:"flex",onSubmit:l,children:s})})})},Oe=()=>{const{t:s}=y(),{language:t,setLanguage:n}=T(),{settings:a}=Y();return((a==null?void 0:a.i18n.languages.length)??0)<=1?null:e.jsx(W,{title:s("Internationalization"),children:e.jsx("div",{className:"mx-5 mb-5",children:e.jsx(de,{value:t,onChange:g=>g&&n(g),className:"w-full",shadow:"xl"})})})},H=({className:s,...t})=>e.jsx(me,{className:v("relative top-0.5 inline-block h-4",s),...t}),Q="D.M. YYYY, HH:mm",Ee=()=>{const{data:s,isLoading:t}=T(),{t:n}=y(),a=p();return a!=null&&a.hasTimestamps?e.jsx(W,{className:"!pt-0",title:n("Publish info"),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[e.jsxs("li",{children:[n("Updated at:")," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?B(s.updated_at).format(Q):n("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[n("Created at:")," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:B(s.created_at).format(Q)})]})]})})}):null},Pe=()=>{const s=p(!0),{isOpen:t}=G();return e.jsxs(ge,{isOpen:t,children:[e.jsx(Ee,{}),e.jsx(Oe,{}),e.jsx(fe,{model:s})]})},Ie=()=>{const{t:s}=y(),t=p(!0);return e.jsx(e.Fragment,{children:e.jsx(he,{className:"py-5",items:[{content:s("Singletons")},{content:e.jsx("p",{className:"flex-none text-green-500 underline",children:t.title||t.name})}]})})},Ae=()=>{const{name:s,title:t,columns:n}=p(!0),{t:a}=y();return i.useMemo(()=>n&&!!Object.entries(Object.fromEntries(n)).find(([o,r])=>!r.hide&&r.editable&&r.admin.editor.placement===xe.MAIN&&r.type==="string"&&r.admin.fieldType==="heading"),[n])?null:e.jsxs(I,{children:[e.jsxs(I.Title,{children:[a("Update")," ",t||s]}),e.jsx(I.Divider,{})]})},Te=()=>{const{watch:s}=R(),t=s(),{t:n}=y(),{isOpen:a,setIsOpen:g}=G(),{data:o,clear:r}=T(),u=p(),{setValue:w,formState:x}=R(),f=i.useMemo(()=>!!Object.keys(J(o||{},t)).length,[t,o]),M=async()=>{confirm(n(ye.ON_DELETE_REQUEST_PROMPT))&&await r()},C=()=>{},O=i.useMemo(()=>{let l="";return x.isSubmitting?l="Updating":l="Update",n(l)},[x.isSubmitting,n]),E=i.useMemo(()=>{let l="";return!(u!=null&&u.isDraftable)||!o?l:(o.is_published?l="Unpublish":l="Publish",n(l))},[o,x.isSubmitting,u,n]),N=()=>{w("is_published",o?!o.is_published:!1)};return e.jsxs(pe,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[e.jsx(V,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:e.jsx(q,{size:"xl",type:"button",loading:x.isSubmitting,onClick:M,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:v(x.isSubmitting&&"!cursor-progress"),children:e.jsx(be,{className:"aspect-square w-10"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[(u==null?void 0:u.isDraftable)&&e.jsx(z,{size:"sm",variant:"white",type:"submit",disabled:x.isSubmitting,className:"ml-auto",onClick:N,px:"sm",children:E}),e.jsx(z,{size:"lg",color:"green",type:"submit",disabled:!f,loading:x.isSubmitting,onClick:C,children:O}),e.jsx(V,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:e.jsx(q,{size:"xl",color:"blue",variant:"light",type:"button",className:v(x.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>g(l=>!l),children:e.jsx(je,{className:v("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},Fe=()=>{const s=p(!0);return e.jsx(Ce,{modelInfo:s})},_e=({})=>p()?e.jsxs(Me,{children:[e.jsxs(Se,{children:[e.jsx(Ie,{}),e.jsxs(we,{children:[e.jsx(Ae,{}),e.jsx(Fe,{}),e.jsx(Te,{})]})]}),e.jsx(Pe,{})]}):e.jsx(Ne,{});export{_e as default};
