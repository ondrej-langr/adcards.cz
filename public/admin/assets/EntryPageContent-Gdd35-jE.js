import{aM as fe,W as ae,R as w,aN as T,aO as je,V as ye,aP as Ne,aQ as Se,aR as we,r as p,aS as ne,u as j,H as V,j as e,e as oe,ay as ve,m as _,M as f,D as v,A as le,T as ie,a2 as z,aT as F,B as D,p as Ee,at as Oe,aj as S,aU as ee,w as B,y as Ce,L as Te,x as _e,a1 as Ae,E as Ie,aI as C,a8 as Ue,aJ as Pe,o as Re}from"./index-LnQetCf-.js";import{L as ke,H as L,W as Fe,C as Le,D as Ve}from"./LanguageMutation-HzfQMmzb.js";import{p as De,F as Be,b as E,d as He,e as Me}from"./prepareFieldsForMapper-rjzHXStO.js";import{A as W}from"./AsideItemWrap-GZxnXfso.js";import{A as ze}from"./AsideWrapper-oGcS6fHR.js";import{u as re}from"./useModelItems-AbJ8PUDc.js";import{S as N}from"./Skeleton-_tGmaWaA.js";import{g as We,a as $e,u as Ye,C as H,O as qe}from"./Select-V6q-zMFP.js";import"./LanguageSelect-4iSOTWds.js";var ce={root:"m-849cf0da"};const Ge={underline:"hover"},$=fe((s,t)=>{const{underline:a,className:n,unstyled:o,mod:l,...c}=ae("Anchor",Ge,s);return w.createElement(T,{component:"a",ref:t,className:je({[ce.root]:!o},n),...c,mod:[{underline:a},l],__staticSelector:"Anchor",unstyled:o})});$.classes=ce;$.displayName="@mantine/core/Anchor";const Ke={},Y=ye((s,t)=>{const a=ae("Autocomplete",Ke,s),{classNames:n,styles:o,unstyled:l,vars:c,dropdownOpened:r,defaultDropdownOpened:d,onDropdownClose:u,onDropdownOpen:i,onFocus:x,onBlur:g,onClick:y,onChange:A,data:I,value:O,defaultValue:m,selectFirstOptionOnChange:U,onOptionSubmit:P,comboboxProps:de,readOnly:R,disabled:q,filter:ue,limit:me,withScrollArea:pe,maxDropdownHeight:he,size:G,id:xe,...ge}=a,K=Ne(xe),Q=We(I),be=$e(Q),[k,X]=Se({value:O,defaultValue:m,finalValue:"",onChange:A}),b=Ye({opened:r,defaultOpened:d,onDropdownOpen:i,onDropdownClose:()=>{u==null||u(),b.resetSelectedOption()}}),{resolvedClassNames:J,resolvedStyles:Z}=we({props:a,styles:o,classNames:n});return p.useEffect(()=>{U&&b.selectFirstOption()},[U,k]),w.createElement(H,{store:b,__staticSelector:"Autocomplete",classNames:J,styles:Z,unstyled:l,readOnly:R,onOptionSubmit:h=>{P==null||P(h),X(be[h].label),b.closeDropdown()},size:G,...de},w.createElement(H.Target,null,w.createElement(ne,{ref:t,...ge,size:G,__staticSelector:"Autocomplete",disabled:q,readOnly:R,value:k,onChange:h=>{X(h.currentTarget.value),b.openDropdown(),U&&b.selectFirstOption()},onFocus:h=>{b.openDropdown(),x==null||x(h)},onBlur:h=>{b.closeDropdown(),g==null||g(h)},onClick:h=>{b.openDropdown(),y==null||y(h)},classNames:J,styles:Z,unstyled:l,id:K})),w.createElement(qe,{data:Q,hidden:R||q,filter:ue,search:k,limit:me,hiddenWhenEmpty:!0,withScrollArea:pe,maxDropdownHeight:he,unstyled:l,labelId:`${K}-label`}))});Y.classes={...ne.classes,...H.classes};Y.displayName="@mantine/core/Autocomplete";const Qe=({model:s})=>{const{t}=j(),a=p.useMemo(()=>{if(s)return De(s,V.ASIDE)},[s]);return a&&a.length?e.jsx(W,{title:t("Other info"),children:e.jsx("div",{className:"mb-5 grid gap-5 p-2",children:e.jsx(Be,{type:V.ASIDE,fields:a})})}):null},Xe=(s,t,a)=>{const n=p.useCallback(()=>oe.userRoles.getOne(s,t).then(({data:o})=>o.data),[s,t]);return ve([_.USER_ROLES,t],n,{enabled:!!s,...a})};p.forwardRef(function({avatar:t,email:a,id:n,name:o,password:l,role:c,state:r,...d},u){const{data:i,isLoading:x}=Xe(typeof c=="string"?c:c==null?void 0:c.id);return e.jsxs("div",{ref:u,...d,children:[e.jsx(T,{children:o}),e.jsx(T,{size:"xs",color:"blue",children:!i||x?e.jsx(N,{width:100,height:20}):i.label})]})});const Je=({withLabel:s=!0,...t})=>{const{t:a}=j(),{data:n}=re(_.USERS,{params:{limit:5,where:{...t.value&&Number.isNaN(Number(t.value))?{name:{manipulator:"LIKE",value:`%${t.value}%`}}:{},...t.value&&!Number.isNaN(Number(t.value))?{id:{manipulator:"LIKE",value:t.value}}:{}}}},{enabled:!!t.value});return e.jsx(Y,{label:s?a(f.USER):void 0,placeholder:a("Start typing to see options"),...t,data:((n==null?void 0:n.data)||[]).map(o=>({...o,value:String(o.name)}))})},Ze=e.jsxs(e.Fragment,{children:[e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30})]}),es=({id:s,name:t,onItemDelete:a})=>e.jsxs("div",{className:"flex justify-between rounded-lg bg-gray-50 px-4 py-2",children:[e.jsx(T,{size:"lg",children:t}),e.jsx(le,{color:"red",variant:"light",onClick:()=>a(s),children:e.jsx(ie,{width:20,height:20})})]}),ss=()=>{const{watch:s,setValue:t,getValues:a}=v(),n=s("coeditors"),o=!Object.keys(n||{}).length,{data:l,isLoading:c}=re(_.USERS,{params:{limit:999,where:{id:{manipulator:"IN",value:Object.keys(n||{})}}}},{enabled:!o}),r=p.useCallback(d=>{const u="coeditors",{...i}=a(u);delete i[d],t(u,i)},[t,a]);return!c||o?e.jsx(e.Fragment,{children:((l==null?void 0:l.data)||[]).map(d=>e.jsx(es,{onItemDelete:r,...d},d.id))}):Ze},ts=()=>{const{itemData:s}=E(),t=z(),[a,n]=p.useState(!1),[o,l]=p.useState(),[c,r]=p.useState(!1),{setValue:d,getValues:u}=v(),{t:i}=j(),x=p.useCallback(({id:g})=>{n(!0);const y=u("coeditors")??{};d("coeditors",{...y,[String(g)]:!0}),n(!1),r(!1),l("")},[u,d]);return!(t!=null&&t.can({action:"update",targetEntityTableName:_.USER_ROLES}))&&(t==null?void 0:t.id)!==(s==null?void 0:s.created_by)?null:e.jsx(e.Fragment,{children:e.jsx(W,{title:i(f.CONTRIBUTORS),description:i(f.ADD_CONTRIBUTOR_TEXT),children:e.jsxs("div",{className:"grid grid-cols-1 gap-2.5 p-2.5",children:[e.jsx(ss,{}),e.jsxs(F,{closeOnClickOutside:!1,closeOnEscape:!1,opened:c,onClose:()=>r(!1),position:"bottom",transitionProps:{transition:"pop-top-right"},width:400,children:[e.jsx(F.Target,{children:e.jsx(D,{className:"w-full",leftSection:e.jsx(Ee,{className:"h-7 w-7"}),variant:"light",type:"button",onClick:()=>r(g=>!g),children:e.jsx("span",{className:"ml-auto inline-block",children:i(f.ADD_CONTRIBUTOR)})})}),e.jsxs(F.Dropdown,{className:"w-full",title:i("Select user"),children:[e.jsx(Je,{withLabel:!1,disabled:a,value:o,onChange:l,onItemSubmit:x}),e.jsx(Oe,{justify:"space-between",style:{marginTop:15},children:e.jsx($,{component:"button",color:"gray",size:"sm",disabled:a,onClick:()=>r(!1),children:i("Cancel")})})]})]})]})})})},M=({className:s,...t})=>e.jsx(N,{className:B("relative top-0.5 inline-block h-4",s),...t}),se=({userId:s})=>{const{t}=j(),{data:a,isLoading:n}=Ce(s,{enabled:!!s}),o=z(),l=Number(s)===Number(o==null?void 0:o.id);return n||!a||!s?e.jsx(M,{className:"inline-block"}):e.jsx(Te,{to:l?"/settings/profile":_e.users.view(s),className:"font-semibold text-blue-600",children:l?t("Me"):a.name})},te="D.M. YYYY, HH:mm",as=()=>{const{itemData:s,itemIsLoading:t}=E(),{t:a}=j(),n=S();return!(n!=null&&n.timestamp)&&!(n!=null&&n.ownable)?null:e.jsx(W,{className:"!pt-0",title:a(f.PUBLISH_INFO),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[(n==null?void 0:n.timestamp)&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[a("Updated at"),":"," ",t?e.jsx(M,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?ee(s.updated_at).format(te):a("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[a("Created at"),":"," ",t?e.jsx(M,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(s.created_at).format(te)})]})]}),(n==null?void 0:n.ownable)&&e.jsxs(e.Fragment,{children:[!!(s!=null&&s.updated_by)&&String(s==null?void 0:s.updated_by)!=="0"&&e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a("Updated by"),":"]})," ",e.jsx(se,{userId:s==null?void 0:s.updated_by})]})}),e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a("Created by"),":"]})," ",s!=null&&s.created_by&&String(s==null?void 0:s.created_by)!=="0"?e.jsx(se,{userId:s==null?void 0:s.created_by}):a("Unknown")]})})]})]})})})},ns=()=>{const s=S(!0);return e.jsxs(ze,{isOpen:!0,children:[e.jsx(as,{}),e.jsx(Qe,{model:s}),s&&s.sharable&&e.jsx(ts,{})]})},os=()=>{const{formState:s}=v(),{t}=j(),{itemData:a,currentView:n,exitView:o}=E(),l=S(),c=z(),[r,d]=p.useState(!1),u=n==="update"&&l&&(c==null?void 0:c.can({action:"create",targetEntityTableName:l==null?void 0:l.name})),i=async()=>{confirm(t(f.ON_DELETE_REQUEST_PROMPT))&&(o(),await oe.entries.for(l==null?void 0:l.name).delete(a==null?void 0:a.id))};return e.jsxs(C,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>d(!0),onClose:()=>d(!1),children:[e.jsx(C.Target,{children:e.jsx(Ue,{withArrow:!0,label:t(f.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:r,children:e.jsx(le,{size:"xl",color:"gray",variant:"light",type:"button",className:B(s.isSubmitting&&"!cursor-progress"),loading:s.isSubmitting,styles:{root:{width:50,height:50}},children:e.jsx(Pe,{className:"aspect-square w-20 duration-150"})})})}),e.jsx(C.Dropdown,{children:u?e.jsx(C.Item,{type:"button",onClick:i,color:"red",className:B(s.isSubmitting&&"!cursor-progress"),leftSection:e.jsx(ie,{className:"aspect-square w-4"}),children:t(f.PURGE_DATA)}):null})]})},ls=()=>{var O;const{watch:s}=v(),t=s(),{t:a}=j(),{itemData:n,currentView:o,setLanguage:l,language:c}=E(),r=S(),d=Ae(),{setValue:u,formState:i}=v(),x=p.useMemo(()=>o==="update"?!!Object.keys(Ie(n||{},t)).length:!0,[t,o,n]),g=()=>{o==="create"&&u("is_published",!0)},y=p.useMemo(()=>{let m="";return o==="create"?i.isSubmitting?m="Publishing":m="Publish":o==="update"&&(i.isSubmitting?m="Updating":m="Update"),a(m)},[o,i.isSubmitting,a]),A=p.useMemo(()=>{let m="";if(!(r!=null&&r.draftable))return m;if(o==="create")i.isSubmitting?m="Saving":m="Save as concept";else if(o==="update"){if(!n)return m;n.is_published?m="Unpublish":m="Publish"}return a(m)},[o,i.isSubmitting,r,n,a]),I=()=>{u("is_published",n?!n.is_published:!1)};return e.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between px-5 rounded-prom bg-transparent",children:[e.jsx("div",{className:"flex gap-3 justify-center"}),e.jsxs("div",{className:"flex items-center gap-3",children:[(r==null?void 0:r.draftable)&&e.jsx(D,{size:"sm",variant:"transparent",type:"submit",disabled:i.isSubmitting,className:"ml-auto",onClick:I,px:"sm",children:A}),e.jsx(D,{size:"lg",color:"green",type:"submit",disabled:!x,loading:i.isSubmitting,onClick:g,children:y}),(((O=d.application)==null?void 0:O.i18n.languages.length)??0)>1&&o==="update"?e.jsx(ke,{language:c??"",onSelect:l}):null,e.jsx(os,{})]})]})},is=()=>{const{currentView:s}=E(),t=S(),{t:a}=j();return p.useMemo(()=>(t==null?void 0:t.columns)&&!!(t!=null&&t.columns.find(o=>!o.hide&&o.admin.editor.placement===V.MAIN&&o.type==="string"&&o.admin.fieldType==="heading")),[t])?null:e.jsxs(L,{children:[e.jsx(L.Title,{children:a(s=="update"?"Update an entry":"Create an entry")}),e.jsx(L.Divider,{})]})},bs=({viewType:s})=>{const t=S();return e.jsx(He,{viewType:s,children:e.jsx(Me.Consumer,{children:({onSubmit:a})=>e.jsx("form",{autoComplete:"off",onSubmit:a,children:e.jsxs(Re,{rightAsideOutlet:e.jsx(ns,{}),children:[e.jsx(ls,{}),e.jsx(Fe,{children:e.jsxs(Le,{children:[e.jsx(is,{}),e.jsx(Ve,{modelInfo:t})]})})]})})})})};export{bs as E};
