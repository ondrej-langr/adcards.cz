import{R as E,I as Te,J as ke,K as De,aU as Ie,Z as Me,r as g,bH as Pe,bd as q,Y as xe,aT as ze,b2 as Ve,V as Ae,b3 as _e,j as e,u as se,bs as be,ao as Q,P as Le,M as A,B as ve,w as _,aS as re,L as ge,x as je,bI as Ne,D as Ue,bD as Fe,H as pe,A as Y,bJ as Be,bK as Oe,ab as $e,T as He,a7 as We}from"./index-yOKIGyhs.js";import{I as Ke}from"./ItemsMissingMessage-BErgMmqr.js";import{N as Ze,u as te,m as K,P as Ge}from"./useModelItems-swOYtnuG.js";import{u as Je}from"./use-disclosure-kjKicoPJ.js";import{S as Xe}from"./Skeleton-ai2isshM.js";import{D as T}from"./Drawer-N9Gfdqty.js";import{C as Ye}from"./FileList-e-NMcu-p.js";import{S as qe}from"./Select-Tmriee6U.js";import{T as w}from"./Table-4rjFBSvi.js";function W(s,t,l){return t===void 0&&l===void 0?s:t!==void 0&&l===void 0?Math.max(s,t):Math.min(t===void 0&&l!==void 0?s:Math.max(s,t),l)}function fe({direction:s,style:t,...l}){return E.createElement("svg",{style:{width:"var(--ni-chevron-size)",height:"var(--ni-chevron-size)",transform:s==="up"?"rotate(180deg)":void 0,...t},viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},E.createElement("path",{d:"M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}var ee={root:"m-e2f5cd4e",controls:"m-95e17d22",control:"m-80b4b171"};const Qe=/^-0(\.0*)?$/,es=/^-?0\d+$/;function ss(s){return(typeof s=="number"?s<Number.MAX_SAFE_INTEGER:!Number.isNaN(Number(s)))&&!Number.isNaN(s)}function rs({value:s,min:t,step:l=1,allowNegative:m}){const i=s-l;return t!==void 0&&i<t?t:!m&&i<0&&t===void 0?s:(t!==void 0&&t>=0&&i<=t,i)}function he(s,t,l){if(s===void 0)return!0;const m=t===void 0||s>=t,i=l===void 0||s<=l;return m&&i}const ts={step:1,clampBehavior:"blur",allowDecimal:!0,allowNegative:!0,startValue:0},as=Ae((s,{size:t})=>({controls:{"--ni-chevron-size":_e(t,"ni-chevron-size")}})),ae=Te((s,t)=>{const l=ke("NumberInput",ts,s),{className:m,classNames:i,styles:j,unstyled:u,vars:x,onChange:v,onValueChange:S,value:a,defaultValue:N,max:d,min:p,step:b,hideControls:o,rightSection:n,isAllowed:c,clampBehavior:h,onBlur:y,allowDecimal:I,decimalScale:M,onKeyDown:k,handlersRef:L,startValue:P,disabled:D,rightSectionPointerEvents:Z,allowNegative:U,readOnly:z,size:F,rightSectionWidth:G,stepHoldInterval:B,stepHoldDelay:le,allowLeadingZeros:ne,...we}=l,J=De({name:"NumberInput",classes:ee,props:l,classNames:i,styles:j,unstyled:u,vars:x,varsResolver:as}),{resolvedClassNames:Se,resolvedStyles:ye}=Ie({classNames:i,styles:j,props:l}),[f,R]=Me({value:a,defaultValue:N,onChange:v}),oe=le!==void 0&&B!==void 0,ie=g.useRef(null),V=g.useRef(null),X=g.useRef(0),Ce=(r,C)=>{C.source==="event"&&R(ss(r.floatValue)&&!Qe.test(r.value)&&!(ne&&es.test(r.value))?r.floatValue:r.value),S==null||S(r,C)},O=g.useRef();O.current=()=>{typeof f!="number"||Number.isNaN(f)?R(W(P,p,d)):R(d!==void 0?f+b<=d?f+b:d:f+b)};const $=g.useRef();$.current=()=>{typeof f!="number"||Number.isNaN(f)?R(W(P,p,d)):R(rs({value:f,min:p,step:b,allowNegative:U}))};const Ee=r=>{k==null||k(r),!z&&(r.key==="ArrowUp"&&(r.preventDefault(),O.current()),r.key==="ArrowDown"&&(r.preventDefault(),$.current()))};Pe(L,{increment:O.current,decrement:$.current});const ce=r=>{r?O.current():$.current(),X.current+=1},de=r=>{if(ce(r),oe){const C=typeof B=="number"?B:B(X.current);V.current=window.setTimeout(()=>de(r),C)}},ue=(r,C)=>{var me;r.preventDefault(),(me=ie.current)==null||me.focus(),ce(C),oe&&(V.current=window.setTimeout(()=>de(C),le))},H=()=>{V.current&&window.clearTimeout(V.current),V.current=null,X.current=0},Re=E.createElement("div",{...J("controls")},E.createElement(q,{...J("control"),tabIndex:-1,"aria-hidden":!0,disabled:D||typeof f=="number"&&d!==void 0&&f>=d,mod:{direction:"up"},onMouseDown:r=>r.preventDefault(),onPointerDown:r=>{ue(r,!0)},onPointerUp:H,onPointerLeave:H},E.createElement(fe,{direction:"up"})),E.createElement(q,{...J("control"),tabIndex:-1,"aria-hidden":!0,disabled:D||typeof f=="number"&&p!==void 0&&f<=p,mod:{direction:"down"},onMouseDown:r=>r.preventDefault(),onPointerDown:r=>{ue(r,!1)},onPointerUp:H,onPointerLeave:H},E.createElement(fe,{direction:"down"})));return E.createElement(xe,{component:Ze,allowNegative:U,className:ze(ee.root,m),size:F,...we,readOnly:z,disabled:D,value:f,getInputRef:Ve(t,ie),onValueChange:Ce,rightSection:o||z?n:n||Re,classNames:Se,styles:ye,unstyled:u,__staticSelector:"NumberInput",decimalScale:I?M:0,onKeyDown:Ee,rightSectionPointerEvents:Z??(D?"none":void 0),rightSectionWidth:G??`var(--ni-right-section-width-${F||"sm"})`,allowLeadingZeros:ne,onBlur:r=>{y==null||y(r),h==="blur"&&typeof f=="number"&&W(f,p,d)!==f&&R(W(f,p,d))},isAllowed:r=>h==="strict"?c?c(r)&&he(r.floatValue,p,d):he(r.floatValue,p,d):c?c(r):!0})});ae.classes={...xe.classes,...ee};ae.displayName="@mantine/core/NumberInput";const ls=({values:s,targetModelTableName:t,labelConstructor:l})=>{const{data:m}=te(t,{params:{limit:9999,where:{id:{manipulator:"IN",value:s.map(({id:u})=>u)}}}}),i=g.useMemo(()=>m==null?void 0:m.data.map(u=>({id:u.id,label:K.render(l,u)})),[m]),j=i==null?void 0:i.map(u=>e.jsxs(w.Tr,{children:[e.jsx(w.Td,{children:u.id}),e.jsx(w.Td,{children:u.label}),e.jsx(w.Td,{children:e.jsx(ge,{target:"_blank",to:je.entryTypes(t).view(u.id),children:e.jsx(re,{size:"sm",color:"blue",children:e.jsx(Ne,{size:15,className:"mr-1 relative top-0.5"})})})})]},u.id));return e.jsxs(w,{verticalSpacing:"md",horizontalSpacing:"lg",striped:!0,children:[e.jsx(w.Thead,{children:e.jsxs(w.Tr,{children:[e.jsx(w.Th,{className:"w-12",children:"ID"}),e.jsx(w.Th,{}),e.jsx(w.Th,{className:"w-12"})]})}),e.jsx(w.Tbody,{children:j})]})},ns=({title:s,targetModelTableName:t,columnName:l,labelConstructor:m,readonly:i})=>{var b;const[j,{toggle:u}]=Je(),{t:x}=se(),[v,S]=g.useState(1),{data:a}=te(t,{params:{page:v}}),{field:N}=be({name:l}),d=g.useMemo(()=>{var o;return(o=a==null?void 0:a.data)==null?void 0:o.map(n=>({id:n.id,value:String(n.id),label:K.render(m,n)}))},[a,x,m]),p=o=>{const n=[...N.value??[]],c=n.findIndex(h=>h.id===o.id);c>-1?n.splice(c,1):n.push({id:o.id}),N.onChange(n)};return e.jsxs(e.Fragment,{children:[e.jsx(Q.Wrapper,{size:"md",classNames:{label:"flex w-full items-center"},label:e.jsx(e.Fragment,{children:e.jsx("span",{children:s})}),children:e.jsx(Le,{className:"mt-1",children:(((b=N.value)==null?void 0:b.length)??0)>0?e.jsx(g.Suspense,{fallback:e.jsx(Xe,{className:"w-full h-24"}),children:e.jsx(ls,{values:N.value??[],targetModelTableName:t,labelConstructor:m})}):e.jsx(Ke,{className:"py-5"})})}),e.jsxs(T.Root,{opened:j,onClose:u,position:"right",offset:8,radius:"md",size:"lg",classNames:{header:"dark:bg-transparent"},children:[e.jsx(T.Overlay,{}),e.jsxs(T.Content,{children:[e.jsxs(T.Header,{children:[e.jsx(T.Title,{children:x(A.SELECT_EXISTING)}),e.jsx(T.CloseButton,{}),e.jsx(ve,{size:"compact-sm",color:"green",className:"ml-2",onClick:u,children:"OK"})]}),e.jsxs(T.Body,{children:[d==null?void 0:d.map(o=>{var c;const n=!!((c=N.value)!=null&&c.find(h=>h.id===o.id));return e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{classNames:{root:"absolute top-2.5 left-2.5 pointer-none",input:n?"":"bg-transparent dark:bg-gray-50"},checked:n,onChange:()=>p(o),tabIndex:-1,size:"md","aria-label":"Select linked"}),e.jsx(q,{className:_("rounded-prom border-2 w-full pl-12 py-1.5 border-solid dark:border-dashed",n?"border-blue-300 bg-blue-50":"border-gray-100 dark:bg-gray-900 dark:backdrop-blur-lg dark:bg-opacity-65"),onClick:()=>p(o),children:e.jsx(re,{className:_("font-bold text-lg",n?"text-gray-800":"dark:text-white text-gray-800"),children:o.label})})]},o.id)}),e.jsx("div",{className:"flex justify-center my-5",children:e.jsx(Ge,{disabled:(a==null?void 0:a.last_page)===1||!(a!=null&&a.last_page),value:v,total:(a==null?void 0:a.last_page)??0,onChange:S})})]})]})]})]})},os=({columnName:s,title:t,error:l,targetModelTableName:m,labelConstructor:i,disabled:j})=>{var d,p,b;const{t:u}=se(),{data:x,isError:v,isLoading:S}=te(m),{field:a}=be({name:s}),N=g.useMemo(()=>{var o;return(o=x==null?void 0:x.data)==null?void 0:o.map(n=>({value:String(n.id),label:K.render(i,n)}))},[x,u,i]);return e.jsxs("div",{className:"w-full",children:[e.jsx(qe,{data:N??(a.value?[{value:String((d=a.value)==null?void 0:d.id),label:K.render(i,a.value)}]:void 0),label:t,value:a.value?String((p=a.value)==null?void 0:p.id):null,onChange:o=>{let n=null;if(o){const c=x==null?void 0:x.data.find(h=>h.id===Number(o));c&&(n={id:c.id})}a.onChange(n)},className:"w-full",placeholder:u("Select an option"),disabled:v||S||j,comboboxProps:{shadow:"xl"},error:l},s),a.value&&!Array.isArray(a.value)?e.jsx(ge,{target:"_blank",to:je.entryTypes(m).view((b=a.value)==null?void 0:b.id),children:e.jsxs(re,{size:"sm",color:"blue",children:[e.jsx(Ne,{size:15,className:"mr-1 relative top-0.5"}),A.SHOW_SELECTED_ITEM]})}):null]})},is=s=>e.jsx("div",{className:"w-full",children:s.multiple?e.jsx(ns,{...s}):e.jsx(os,{...s})}),vs=({name:s,label:t,columns:l,placement:m,disabled:i,readonly:j})=>{const{formState:u,register:x}=Ue(),{t:v}=se(),S=`${s}.data`,{fields:a,remove:N,move:d,append:p}=Fe({name:S}),b=g.useMemo(()=>!!Array.from(l.values()).find(({title:n})=>!!n),[l]),o=g.useMemo(()=>a.length?a:j?[]:[{id:"default"}],[a,j]);return e.jsx(Q.Wrapper,{size:"md",classNames:{label:"flex w-full justify-between items-center"},label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t}),e.jsx(ve,{size:"compact-sm",color:"green",onClick:()=>p({}),children:v(A.ADD_ROW)})]}),children:e.jsxs("div",{className:_(["mt-2 flex flex-col divide-y-2 divide-blue-100",m===pe.MAIN&&"rounded-lg border border-blue-200 bg-white dark:bg-transparent backdrop-blur-md p-2"]),children:[o.map((n,c)=>e.jsxs("div",{className:_("flex w-full gap-2 first:pt-0 last:pb-0","py-3"),children:[e.jsxs("div",{className:"flex flex-col w-10 justify-end",children:[e.jsx(Y,{size:"sm",disabled:c===0,className:"w-full max-h-[22px] min-h-[22px] rounded-b-none rounded-prom",variant:"white",onClick:()=>d(c,c-1),children:e.jsx(Be,{size:16})}),e.jsx(Y,{size:"sm",disabled:o.length-1===c,className:"w-full max-h-[22px] min-h-[22px] rounded-t-none rounded-prom",variant:"white",onClick:()=>d(c,c+1),children:e.jsx(Oe,{size:16})})]}),l.map(h=>{var P;let y=e.jsx(e.Fragment,{});const I=`${S}.${c}.${h.name}`,M=v(((P=u.errors[h.name])==null?void 0:P.message)||""),k=h.title||(b?v(`${s} label`):void 0),L=h.title?void 0:{className:"opacity-0"};switch(h.type){case"number":y=e.jsx(We,{name:I,render:({field:{onChange:D,name:Z,onBlur:U,ref:z,value:F}})=>e.jsx(ae,{ref:z,name:Z,onBlur:U,onChange:G=>D(G),label:k,autoComplete:"off",labelProps:L,error:M,value:F,className:"w-full",disabled:i})});break;case"string":y=e.jsx($e,{label:k,type:"string",autoComplete:"off",error:M,className:"w-full",labelProps:L,disabled:i,...x(I)});break;case"relationship":y=e.jsx(is,{error:M,disabled:i,admin:{editor:{placement:pe.MAIN,width:12},isHidden:!1},columnName:I,unique:!1,...h,localized:!1});break}return e.jsx(g.Fragment,{children:y},h.name)}),j?null:e.jsx(Q.Wrapper,{label:b?v("Actions"):void 0,labelProps:{className:"opacity-0"},className:"flex-none",children:e.jsx("div",{className:"grid grid-cols-1",children:e.jsx(Y,{disabled:c===0||i,className:_(c==0&&"opacity-0"),p:"xs",size:"xl",variant:"subtle",color:"red",onClick:()=>confirm(v(A.ON_DELETE_REQUEST_PROMPT))&&N(c),children:e.jsx(He,{})})})})]},n.id)),o!=null&&o.length?null:e.jsx("p",{children:v(A.EMPTY_VALUE)})]})})};export{ae as N,vs as R,is as a,W as c};
