import{aH as Y,r,g as Z,i as T,aC as $,aI as ee,au as se,aJ as te,Z as ne,aK as U,Y as ae,aL as oe,u as y,q as re,aM as _,J as W,X as ie,aN as le,aO as ce,j as e,a1 as ue,L as J,aE as de,aP as B,ae as me,Q as v,aQ as K,K as ge,aR as fe,a2 as he,E as xe,aS as I,y as R,al as pe,f as V,A as q,R as be,o as z,aT as je,M as ye,N as Ne,aU as we,aV as Se,aW as Ce}from"./index-b327c237.js";const ke=s=>{const{singletons:t}=Y();return r.useMemo(()=>t&&t[s],[s,t])},x=(s=!1)=>{const{singletonId:t}=Z(),a=r.useMemo(()=>String(t),[t]),n=ke(a);if(s&&!n)throw new Error("Model not found");return r.useMemo(()=>n?{...n,key:a}:void 0,[a,n])},ve=(s,t)=>{const a=x(!0),n=r.useCallback(()=>T.singletons.getOne(a.key,s).then(({data:o})=>o.data),[a,s]),m=r.useMemo(()=>[a.key],[a.key]),i=$([m,s],n,{...t});return r.useMemo(()=>({...i,key:m}),[m,i])},G=r.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),A=()=>r.useContext(G),Me=({children:s})=>{var D;const t=ee(),a=se(),n=x(!0),m=r.useMemo(()=>{if(!n)return;const u=te(n,!0);return async(h,g,b)=>{const w=await ne(u)(h,g,b);return U.warning("Validating form:"),U.warning({data:h,result:w}),w}},[n]),i=ae({defaultValues:oe(n,n??{}),reValidateMode:"onChange",mode:"onTouched",resolver:m}),{t:o}=y(),[c,S]=r.useState((D=a==null?void 0:a.i18n)==null?void 0:D.default),f=re(),{data:p,isLoading:M,key:C}=ve({language:c},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:E,setError:O}=i,N=r.useCallback(u=>f.setQueryData(C,u),[C]);r.useEffect(()=>{var u;if(p&&t.refs.current)for(const[h,g]of Object.entries(t.refs.current))p[h]&&((u=g==null?void 0:g.blocks)==null||u.render(p[h]))},[p,i]);const l=E(async u=>{var g,b,w;const h=n.key;if(t.refs.current)for(const[j,d]of Object.entries(t.refs.current))await(d==null?void 0:d.isReady),d&&"save"in d&&(u[j]=JSON.stringify(await d.save()));try{await _({title:"Updating",message:o("Updating, please wait..."),successMessage:o("Your entry is updated!")},async()=>{const j=W(p,u),{data:{data:d}}=await T.singletons.update(h,j,{language:c});N(d)})}catch(j){if(ie.isAxiosError(j)&&le(j.response)&&((b=(g=j.response)==null?void 0:g.data)==null?void 0:b.code)===ce){const d=j.response.data.data;if(Array.isArray(d)&&d.length)for(const P of d){const k=(w=n==null?void 0:n.columns)==null?void 0:w.get(P);let L=P;P==="slug"&&(k==null?void 0:k.type)==="slug"&&(L=k.of),O(L,{message:o("This field is unique and other entry has the same value")})}}}}),F=r.useCallback(async()=>_({message:o("Clearing singleton..."),title:o("Clearing"),errorMessage:o("Failed to clear"),successMessage:o("Clearing successful!")},async()=>{var h,g;const{data:{data:u}}=await T.singletons.clear(n==null?void 0:n.key);if(t.refs.current)for(const b of Object.values(t.refs.current))(g=b==null?void 0:(h=b.blocks).clear)==null||g.call(h);i.reset(u),N(u)}),[N,n,o,t,i.reset]),X=r.useMemo(()=>({language:c,setLanguage:S,data:p,isLoading:M,clear:F}),[c,S,F]);return e.jsx(ue,{...i,children:e.jsx(G.Provider,{value:X,children:e.jsx("form",{className:"flex",onSubmit:l,children:s})})})},Ee=()=>{const{t:s}=y(),{language:t,setLanguage:a}=A(),{settings:n}=Y();return((n==null?void 0:n.i18n.languages.length)??0)<=1?null:e.jsx(J,{title:s("Internationalization"),children:e.jsx("div",{className:"mx-5 mb-5",children:e.jsx(de,{value:t,onChange:m=>m&&a(m),className:"w-full",shadow:"xl"})})})},H=({className:s,...t})=>e.jsx(me,{className:v("relative top-0.5 inline-block h-4",s),...t}),Q="D.M. YYYY, HH:mm",Oe=()=>{const{data:s,isLoading:t}=A(),{t:a}=y(),n=x();return n!=null&&n.hasTimestamps?e.jsx(J,{className:"!pt-0",title:a("Publish info"),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[e.jsxs("li",{children:[a("Updated at:")," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?B(s.updated_at).format(Q):a("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[a("Created at:")," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:B(s.created_at).format(Q)})]})]})})}):null},Pe=()=>{const s=x(!0),{isOpen:t}=K();return e.jsxs(ge,{isOpen:t,children:[e.jsx(Oe,{}),e.jsx(Ee,{}),e.jsx(fe,{model:s})]})},Ie=()=>{const{t:s}=y(),t=x(!0);return e.jsx(e.Fragment,{children:e.jsx(he,{className:"py-5",items:[{content:s("Singletons")},{content:e.jsx("p",{className:"flex-none text-green-500 underline",children:t.title||t.name})}]})})},Te=()=>{const{name:s,title:t,columns:a}=x(!0),{t:n}=y();return r.useMemo(()=>a&&!!Object.entries(Object.fromEntries(a)).find(([i,o])=>!o.hide&&o.editable&&o.admin.editor.placement===xe.MAIN&&o.type==="string"&&o.admin.fieldType==="heading"),[a])?null:e.jsxs(I,{children:[e.jsxs(I.Title,{children:[n("Update")," ",t||s]}),e.jsx(I.Divider,{})]})},Ae=()=>{const{watch:s}=R(),t=s(),{t:a}=y(),{isOpen:n,setIsOpen:m}=K(),{data:i,clear:o}=A(),c=x(),{setValue:S,formState:f}=R(),p=r.useMemo(()=>!!Object.keys(W(i||{},t)).length,[t,i]),M=async()=>{confirm(a(ye.ON_DELETE_REQUEST_PROMPT))&&await o()},C=()=>{},E=r.useMemo(()=>{let l="";return f.isSubmitting?l="Updating":l="Update",a(l)},[f.isSubmitting,a]),O=r.useMemo(()=>{let l="";return!(c!=null&&c.isDraftable)||!i?l:(i.is_published?l="Unpublish":l="Publish",a(l))},[i,f.isSubmitting,c,a]),N=()=>{S("is_published",i?!i.is_published:!1)};return e.jsxs(pe,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[e.jsx(V,{withArrow:!0,label:a("Clean data"),position:"top",color:"gray",children:e.jsx(q,{size:"xl",type:"button",loading:f.isSubmitting,onClick:M,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:v(f.isSubmitting&&"!cursor-progress"),children:e.jsx(be,{className:"aspect-square w-10"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[(c==null?void 0:c.isDraftable)&&e.jsx(z,{size:"sm",variant:"white",type:"submit",disabled:f.isSubmitting,className:"ml-auto",onClick:N,px:"sm",children:O}),e.jsx(z,{size:"lg",color:"green",type:"submit",disabled:!p,loading:f.isSubmitting,onClick:C,children:E}),e.jsx(V,{withArrow:!0,label:a("Toggle more options"),position:"top",color:"gray",children:e.jsx(q,{size:"xl",color:"blue",variant:"light",type:"button",className:v(f.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>m(l=>!l),children:e.jsx(je,{className:v("aspect-square w-20 duration-150",n&&"rotate-180")})})})]})]})},Fe=()=>{const s=x(!0);return e.jsx(Ce,{modelInfo:s})},Le=({})=>x()?e.jsxs(Me,{children:[e.jsxs(we,{children:[e.jsx(Ie,{}),e.jsxs(Se,{children:[e.jsx(Te,{}),e.jsx(Fe,{}),e.jsx(Ae,{})]})]}),e.jsx(Pe,{})]}):e.jsx(Ne,{});export{Le as default};
