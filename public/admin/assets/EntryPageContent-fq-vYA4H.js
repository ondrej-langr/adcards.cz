import{aQ as je,K as ae,R as w,aR as C,aS as Ee,I as Ne,aD as Se,N as we,aT as ye,r as h,J as ne,u as j,H as _,j as e,M as u,e as le,Q as Te,l as D,D as y,A as ie,T as oe,a5 as Y,aU as k,B as F,p as Oe,au as ve,aj as T,aV as ee,w as V,y as Ae,L as Ce,x as _e,a4 as De,E as Re,aN as A,a9 as Ie,aO as Pe,o as Le}from"./index-SAZ6haNj.js";import{p as re,F as Ue,b as O,d as ke,e as Be}from"./prepareFieldsForMapper-bBoDZrHs.js";import"./ImageSelect-3Gp8KeLo.js";import{u as ce}from"./useModelItems-twPoOEQZ.js";import"./FileList-mh70E_HU.js";import{A as z}from"./AsideItemWrap-ptwod5gA.js";import{A as Fe}from"./AsideWrapper-TZP70yuV.js";import{H as B,L as Ve,W as He,C as Me,D as Ye}from"./LanguageMutation-kI_vXSCf.js";import{S as N}from"./Skeleton-C4hdwXqm.js";import{g as ze,a as We,u as $e,C as H,O as Ke}from"./Select-rg4I4KJ2.js";var de={root:"m-849cf0da"};const Qe={underline:"hover"},W=je((t,s)=>{const{underline:a,className:n,unstyled:l,mod:i,...c}=ae("Anchor",Qe,t);return w.createElement(C,{component:"a",ref:s,className:Ee({[de.root]:!l},n),...c,mod:[{underline:a},i],__staticSelector:"Anchor",unstyled:l})});W.classes=de;W.displayName="@mantine/core/Anchor";const qe={},$=Ne((t,s)=>{const a=ae("Autocomplete",qe,t),{classNames:n,styles:l,unstyled:i,vars:c,dropdownOpened:o,defaultDropdownOpened:m,onDropdownClose:p,onDropdownOpen:r,onFocus:g,onBlur:b,onClick:E,onChange:R,data:I,value:S,defaultValue:v,selectFirstOptionOnChange:d,onOptionSubmit:P,comboboxProps:ue,readOnly:L,disabled:K,filter:me,limit:pe,withScrollArea:he,maxDropdownHeight:xe,size:Q,id:ge,...be}=a,q=Se(ge),G=ze(I),fe=We(G),[U,X]=we({value:S,defaultValue:v,finalValue:"",onChange:R}),f=$e({opened:o,defaultOpened:m,onDropdownOpen:r,onDropdownClose:()=>{p==null||p(),f.resetSelectedOption()}}),{resolvedClassNames:J,resolvedStyles:Z}=ye({props:a,styles:l,classNames:n});return h.useEffect(()=>{d&&f.selectFirstOption()},[d,U]),w.createElement(H,{store:f,__staticSelector:"Autocomplete",classNames:J,styles:Z,unstyled:i,readOnly:L,onOptionSubmit:x=>{P==null||P(x),X(fe[x].label),f.closeDropdown()},size:Q,...ue},w.createElement(H.Target,null,w.createElement(ne,{ref:s,...be,size:Q,__staticSelector:"Autocomplete",disabled:K,readOnly:L,value:U,onChange:x=>{X(x.currentTarget.value),f.openDropdown(),d&&f.selectFirstOption()},onFocus:x=>{f.openDropdown(),g==null||g(x)},onBlur:x=>{f.closeDropdown(),b==null||b(x)},onClick:x=>{f.openDropdown(),E==null||E(x)},classNames:J,styles:Z,unstyled:i,id:q})),w.createElement(Ke,{data:G,hidden:L||K,filter:me,search:U,limit:pe,hiddenWhenEmpty:!0,withScrollArea:he,maxDropdownHeight:xe,unstyled:i,labelId:`${q}-label`}))});$.classes={...ne.classes,...H.classes};$.displayName="@mantine/core/Autocomplete";const Ge=({model:t})=>{const{t:s}=j(),a=h.useMemo(()=>{if(t)return re(t,_.ASIDE)},[t]);return a&&a.length?e.jsx(z,{title:s(u.OTHER_INFO),children:e.jsx("div",{className:"mb-5 flex flex-wrap gap-y-5 items-baseline p-2",children:e.jsx(Ue,{type:_.ASIDE,fields:a})})}):null},Xe=(t,s,a)=>{const n=h.useCallback(()=>le.userRoles.getOne(t,s).then(({data:l})=>l.data),[t,s]);return Te([D.USER_ROLES,s],n,{enabled:!!t,...a})};h.forwardRef(function({avatar:s,email:a,id:n,name:l,password:i,role:c,state:o,...m},p){const{data:r,isLoading:g}=Xe(typeof c=="string"?c:c==null?void 0:c.id);return e.jsxs("div",{ref:p,...m,children:[e.jsx(C,{children:l}),e.jsx(C,{size:"xs",color:"blue",children:!r||g?e.jsx(N,{width:100,height:20}):r.label})]})});const Je=({withLabel:t=!0,...s})=>{const{t:a}=j(),{data:n}=ce(D.USERS,{params:{limit:5,where:{...s.value&&Number.isNaN(Number(s.value))?{name:{manipulator:"LIKE",value:`%${s.value}%`}}:{},...s.value&&!Number.isNaN(Number(s.value))?{id:{manipulator:"LIKE",value:s.value}}:{}}}},{enabled:!!s.value});return e.jsx($,{label:t?a(u.USER):void 0,placeholder:a(u.PLACEHOLDER_AUTOCOMPLETE),...s,data:((n==null?void 0:n.data)||[]).map(l=>({...l,value:String(l.name)}))})},Ze=e.jsxs(e.Fragment,{children:[e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30}),e.jsx(N,{width:"100%",height:30})]}),es=({id:t,name:s,onItemDelete:a})=>e.jsxs("div",{className:"flex justify-between rounded-lg bg-gray-50 px-4 py-2",children:[e.jsx(C,{size:"lg",children:s}),e.jsx(ie,{color:"red",variant:"light",onClick:()=>a(t),children:e.jsx(oe,{width:20,height:20})})]}),ss=()=>{const{watch:t,setValue:s,getValues:a}=y(),n=t("coeditors"),l=!Object.keys(n||{}).length,{data:i,isLoading:c}=ce(D.USERS,{params:{limit:999,where:{id:{manipulator:"IN",value:Object.keys(n||{})}}}},{enabled:!l}),o=h.useCallback(m=>{const p="coeditors",{...r}=a(p);delete r[m],s(p,r)},[s,a]);return!c||l?e.jsx(e.Fragment,{children:((i==null?void 0:i.data)||[]).map(m=>e.jsx(es,{onItemDelete:o,...m},m.id))}):Ze},ts=()=>{const{itemData:t}=O(),s=Y(),[a,n]=h.useState(!1),[l,i]=h.useState(),[c,o]=h.useState(!1),{setValue:m,getValues:p}=y(),{t:r}=j(),g=h.useCallback(({id:b})=>{n(!0);const E=p("coeditors")??{};m("coeditors",{...E,[String(b)]:!0}),n(!1),o(!1),i("")},[p,m]);return!(s!=null&&s.can({action:"update",targetEntityTableName:D.USER_ROLES}))&&(s==null?void 0:s.id)!==(t==null?void 0:t.created_by)?null:e.jsx(e.Fragment,{children:e.jsx(z,{title:r(u.CONTRIBUTORS),description:r(u.ADD_CONTRIBUTOR_TEXT),children:e.jsxs("div",{className:"grid grid-cols-1 gap-2.5 p-2.5",children:[e.jsx(ss,{}),e.jsxs(k,{closeOnClickOutside:!1,closeOnEscape:!1,opened:c,onClose:()=>o(!1),position:"bottom",transitionProps:{transition:"pop-top-right"},width:400,children:[e.jsx(k.Target,{children:e.jsx(F,{className:"w-full",leftSection:e.jsx(Oe,{className:"h-7 w-7"}),variant:"light",type:"button",onClick:()=>o(b=>!b),children:e.jsx("span",{className:"ml-auto inline-block",children:r(u.ADD_CONTRIBUTOR)})})}),e.jsxs(k.Dropdown,{className:"w-full",title:r(u.SELECT_USER_PLACEHOLDER),children:[e.jsx(Je,{withLabel:!1,disabled:a,value:l,onChange:i,onItemSubmit:g}),e.jsx(ve,{justify:"space-between",style:{marginTop:15},children:e.jsx(W,{component:"button",color:"gray",size:"sm",disabled:a,onClick:()=>o(!1),children:r(u.CANCEL_ACTION)})})]})]})]})})})},M=({className:t,...s})=>e.jsx(N,{className:V("relative top-0.5 inline-block h-4",t),...s}),se=({id:t,name:s})=>{const{t:a}=j(),{data:n,isLoading:l}=Ae(t,{enabled:!!t&&!s}),i=Y(),c=(n==null?void 0:n.name)??s,o=Number(t)===Number(i==null?void 0:i.id)||c===(i==null?void 0:i.name);return l&&!s||!c||!t?e.jsx(M,{className:"inline-block"}):e.jsx(Ce,{to:o?"/settings/profile":_e.users.view(t),className:"font-semibold text-blue-600",children:o?a(u.ME):c})},te="D.M. YYYY, HH:mm",as=()=>{const{itemData:t,itemIsLoading:s}=O(),{t:a}=j(),n=T();return e.jsx(z,{className:"!pt-0",title:a(u.PUBLISH_INFO),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[(n==null?void 0:n.timestamp)&&e.jsxs(e.Fragment,{children:[!!(t!=null&&t.updatedAt)&&e.jsxs("li",{children:[a(u.UPDATED_AT),":"," ",s?e.jsx(M,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(t.updatedAt).format(te)})]}),!!(t!=null&&t.createdAt)&&e.jsxs("li",{children:[a(u.CREATED_AT),":"," ",s?e.jsx(M,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:ee(t.createdAt).format(te)})]})]}),(n==null?void 0:n.ownable)&&e.jsxs(e.Fragment,{children:[t!=null&&t.updatedBy?e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a(u.UPDATED_BY),":"]})," ",e.jsx(se,{...t.updatedBy})]})}):null,t!=null&&t.createdBy?e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"flex-none",children:[a(u.CREATED_BY),":"]})," ",e.jsx(se,{...t.createdBy})]})}):null]})]})})})},ns=()=>{const{currentView:t}=O(),s=T(),{t:a}=j();return h.useMemo(()=>(s==null?void 0:s.columns)&&!!(s!=null&&s.columns.find(l=>!l.hide&&l.admin.editor.placement===_.MAIN&&l.type==="string"&&l.admin.fieldType==="heading")),[s])?null:e.jsxs(B,{children:[e.jsx(B.Title,{children:a(t=="update"?u.UPDATE_AN_ENTRY:u.CREATE_AN_ENTRY)}),e.jsx(B.Divider,{})]})},ls=()=>{const{formState:t}=y(),{t:s}=j(),{itemData:a,currentView:n,exitView:l}=O(),i=T(),c=Y(),[o,m]=h.useState(!1),p=n==="update"&&i&&(c==null?void 0:c.can({action:"create",targetEntityTableName:i==null?void 0:i.name})),r=async()=>{confirm(s(u.ON_DELETE_REQUEST_PROMPT))&&(l(),await le.entries.for(i==null?void 0:i.name).delete(a==null?void 0:a.id))};return e.jsxs(A,{withArrow:!0,arrowPosition:"center",position:"bottom-end",onOpen:()=>m(!0),onClose:()=>m(!1),children:[e.jsx(A.Target,{children:e.jsx(Ie,{withArrow:!0,label:s(u.MORE_OPTIONS_BUTTON_TEXT),position:"bottom-end",arrowPosition:"center",color:"gray",disabled:o,children:e.jsx(ie,{size:"xl",color:"gray",variant:"light",type:"button",className:V(t.isSubmitting&&"!cursor-progress"),loading:t.isSubmitting,styles:{root:{width:50,height:50}},children:e.jsx(Pe,{className:"aspect-square w-20 duration-150"})})})}),e.jsx(A.Dropdown,{children:p?e.jsx(A.Item,{type:"button",onClick:r,color:"red",className:V(t.isSubmitting&&"!cursor-progress"),leftSection:e.jsx(oe,{className:"aspect-square w-4"}),children:s(u.DELETE)}):null})]})},is=()=>{var v;const{watch:t}=y(),s=t(),{t:a}=j(),{itemData:n,currentView:l,setLanguage:i,language:c}=O(),o=T(),m=De(),{setValue:p,formState:r}=y(),g=h.useMemo(()=>l==="update"?!!Object.keys(Re(n||{},s)).length:!0,[s,l,n]),b=()=>{l==="create"&&p("published",!0)},E=h.useMemo(()=>{let d="";return l==="create"?r.isSubmitting?d="Publishing":d="Publish":l==="update"&&(r.isSubmitting?d="Updating":d="Update"),a(d)},[l,r.isSubmitting,a]),R=h.useMemo(()=>{let d="";if(!(o!=null&&o.draftable))return d;if(l==="create")r.isSubmitting?d="Saving":d="Save as concept";else if(l==="update"){if(!n)return d;n.published?d="Unpublish":d="Publish"}return a(d)},[l,r.isSubmitting,o,n,a]),I=()=>{p("published",n?!n.published:!1)},S=h.useMemo(()=>o==null?void 0:o.columns.filter(d=>d.localized),[o]);return e.jsxs("nav",{className:"align-center sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between px-5 rounded-prom bg-transparent",children:[e.jsx("div",{className:"flex gap-3 justify-center"}),e.jsxs("div",{className:"flex items-center gap-3",children:[(o==null?void 0:o.draftable)&&e.jsx(F,{size:"sm",variant:"transparent",type:"submit",disabled:r.isSubmitting,className:"ml-auto",onClick:I,px:"sm",children:R}),e.jsx(F,{size:"lg",color:"green",type:"submit",disabled:!g,loading:r.isSubmitting,onClick:b,children:E}),(((v=m.application)==null?void 0:v.i18n.languages.length)??0)>1&&(S!=null&&S.length)&&l==="update"?e.jsx(Ve,{language:c??"",onSelect:i}):null,e.jsx(ls,{})]})]})},bs=({viewType:t})=>{const s=T(),a=h.useMemo(()=>{if(s)return re(s,_.ASIDE)},[s]);return e.jsx(ke,{viewType:t,children:e.jsx(Be.Consumer,{children:({onSubmit:n})=>e.jsx("form",{autoComplete:"off",onSubmit:n,className:"h-full",children:e.jsxs(Le,{rightAsideOutlet:s&&(s!=null&&s.timestamp&&(s!=null&&s.ownable)||a!=null&&a.length||s!=null&&s.sharable)?e.jsxs(Fe,{isOpen:!0,children:[s!=null&&s.timestamp&&(s!=null&&s.ownable)?e.jsx(as,{}):null,a!=null&&a.length?e.jsx(Ge,{model:s}):null,(s==null?void 0:s.sharable)&&e.jsx(ts,{})]}):void 0,children:[e.jsx(is,{}),e.jsx(He,{children:e.jsxs(Me,{children:[e.jsx(ns,{}),e.jsx(Ye,{modelInfo:s})]})})]})})})})};export{bs as E};
