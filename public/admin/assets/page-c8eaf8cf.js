import{aS as Y,r as i,J as K,a as T,u as X,aT as Z,aF as ee,aU as se,o as te,aV as ne,ai as ae,k as w,b as oe,aW as U,ac as Q,v as re,aX as ie,aY as le,j as e,al as ce,ae as W,aP as ue,aZ as B,S as de,i as y,a_ as J,a$ as me,am as ge,a9 as fe,b0 as P,a7 as L,ax as he,E as z,A as V,T as xe,_ as R,b1 as pe,a0 as be,y as je,b2 as ye,b3 as we,b4 as Ne}from"./index-94e961fe.js";const Se=s=>{const{singletons:t}=Y();return i.useMemo(()=>t&&t[s],[s,t])},x=(s=!1)=>{const{singletonId:t}=K(),n=i.useMemo(()=>String(t),[t]),a=Se(n);if(s&&!a)throw new Error("Model not found");return i.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},ke=(s,t)=>{const n=x(!0),a=i.useCallback(()=>T.singletons.getOne(n.key,s).then(({data:r})=>r.data),[n,s]),c=i.useMemo(()=>[n.key],[n.key]),o=X([c,s],a,{...t});return i.useMemo(()=>({...o,key:c}),[c,o])},G=i.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),F=()=>i.useContext(G),Ce=({children:s})=>{var A;const t=Z(),n=ee(),a=x(!0),c=i.useMemo(()=>a&&se(a,!0),[a]),o=te({defaultValues:ne(a),reValidateMode:"onChange",mode:"onTouched",resolver:c&&ae(c)}),{t:r}=w(),[u,S]=i.useState((A=n==null?void 0:n.i18n)==null?void 0:A.default),f=oe(),{data:m,isLoading:v,key:k}=ke({language:u},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:M,setError:O}=o,N=i.useCallback(h=>f.setQueryData(k,h),[k]);i.useEffect(()=>{var h;if(m&&(o.reset({...Object.fromEntries(Object.entries(m).filter(([p,g])=>g!==null)),...m.content?{content:JSON.stringify(m.content)}:{}}),t.refs.current))for(const[p,g]of Object.entries(t.refs.current))m[p]&&((h=g==null?void 0:g.blocks)==null||h.render(m[p]))},[m,o]);const l=M(async h=>{var g,j,_;const p=a.key;if(t.refs.current)for(const[b,d]of Object.entries(t.refs.current))await(d==null?void 0:d.isReady),d&&"save"in d&&(h[b]=JSON.stringify(await d.save()));try{await U({title:"Updating",message:r("Updating, please wait..."),successMessage:r("Your entry is updated!")},async()=>{const b=Q(m,h),{data:{data:d}}=await T.singletons.update(p,b,{language:u});N(d)})}catch(b){if(re.isAxiosError(b)&&ie(b.response)&&((j=(g=b.response)==null?void 0:g.data)==null?void 0:j.code)===le){const d=b.response.data.data;if(Array.isArray(d)&&d.length)for(const E of d){const C=(_=a==null?void 0:a.columns)==null?void 0:_.get(E);let D=E;E==="slug"&&(C==null?void 0:C.type)==="slug"&&(D=C.of),O(D,{message:r("This field is unique and other entry has the same value")})}}}}),I=i.useCallback(async()=>U({message:r("Clearing singleton..."),title:r("Clearing"),errorMessage:r("Failed to clear"),successMessage:r("Clearing successful!")},async()=>{var p,g;const{data:{data:h}}=await T.singletons.clear(a==null?void 0:a.key);if(t.refs.current)for(const j of Object.values(t.refs.current))(g=j==null?void 0:(p=j.blocks).clear)==null||g.call(p);o.reset(h),N(h)}),[N,a,r,t,o.reset]),$=i.useMemo(()=>({language:u,setLanguage:S,data:m,isLoading:v,clear:I}),[u,S,I]);return e.jsx(ce,{...o,children:e.jsx(G.Provider,{value:$,children:e.jsx("form",{className:"flex",onSubmit:l,children:s})})})},ve=()=>{const{t:s}=w(),{language:t,setLanguage:n}=F(),{settings:a}=Y();return((a==null?void 0:a.i18n.languages.length)??0)<=1?null:e.jsx(W,{title:s("Internationalization"),children:e.jsx("div",{className:"mx-5 mb-5",children:e.jsx(ue,{value:t,onChange:c=>c&&n(c),className:"w-full",shadow:"xl"})})})},q=({className:s,...t})=>e.jsx(de,{className:y("relative top-0.5 inline-block h-4",s),...t}),H="D.M. YYYY, HH:mm",Me=()=>{const{data:s,isLoading:t}=F(),{t:n}=w(),a=x();return a!=null&&a.hasTimestamps?e.jsx(W,{className:"!pt-0",title:n("Publish info"),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[e.jsxs("li",{children:[n("Updated at:")," ",t?e.jsx(q,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?B(s.updated_at).format(H):n("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[n("Created at:")," ",t?e.jsx(q,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:B(s.created_at).format(H)})]})]})})}):null},Oe=()=>{const s=x(!0),{isOpen:t}=J();return e.jsx("aside",{className:y("sticky top-0 z-10 transition-[width] duration-300",t?"w-[500px]":"h-0 w-0 overflow-hidden"),children:e.jsxs("div",{className:y("h-full w-[500px] py-5 pl-8 flex flex-col gap-5"),children:[e.jsx(Me,{}),e.jsx(ve,{}),e.jsx(me,{model:s})]})})},Ee=()=>{const{t:s}=w(),t=x(!0);return e.jsx(e.Fragment,{children:e.jsx(ge,{className:"py-5",items:[{content:s("Singletons")},{content:e.jsx("p",{className:"flex-none text-green-500 underline",children:t.title||t.name})}]})})},Pe=()=>{const{name:s,title:t,columns:n}=x(!0),{t:a}=w();return i.useMemo(()=>n&&!!Object.entries(Object.fromEntries(n)).find(([o,r])=>!r.hide&&r.editable&&r.admin.editor.placement===fe.MAIN&&r.type==="string"&&r.admin.fieldType==="heading"),[n])?null:e.jsxs(P,{children:[e.jsxs(P.Title,{children:[a("Update")," ",t||s]}),e.jsx(P.Divider,{})]})},Te=()=>{const{watch:s}=L(),t=s(),{t:n}=w(),{isOpen:a,setIsOpen:c}=J(),{data:o,clear:r}=F(),u=x(),{setValue:S,formState:f}=L(),m=i.useMemo(()=>!!Object.keys(Q(o||{},t)).length,[t,o]),v=async()=>{confirm(n(be.ON_DELETE_REQUEST_PROMPT))&&await r()},k=()=>{},M=i.useMemo(()=>{let l="";return f.isSubmitting?l="Updating":l="Update",n(l)},[f.isSubmitting,n]),O=i.useMemo(()=>{let l="";return!(u!=null&&u.isDraftable)||!o?l:(o.is_published?l="Unpublish":l="Publish",n(l))},[o,f.isSubmitting,u,n]),N=()=>{S("is_published",o?!o.is_published:!1)};return e.jsxs(he,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[e.jsx(z,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:e.jsx(V,{size:"xl",type:"button",loading:f.isSubmitting,onClick:v,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:y(f.isSubmitting&&"!cursor-progress"),children:e.jsx(xe,{className:"aspect-square w-10"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[(u==null?void 0:u.isDraftable)&&e.jsx(R,{size:"sm",variant:"white",type:"submit",disabled:f.isSubmitting,className:"ml-auto",onClick:N,px:"sm",children:O}),e.jsx(R,{size:"lg",color:"green",type:"submit",disabled:!m,loading:f.isSubmitting,onClick:k,children:M}),e.jsx(z,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:e.jsx(V,{size:"xl",color:"blue",variant:"light",type:"button",className:y(f.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>c(l=>!l),children:e.jsx(pe,{className:y("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},Fe=()=>{const s=x(!0);return e.jsx(Ne,{modelInfo:s})},Ae=({})=>x()?e.jsxs(Ce,{children:[e.jsxs(ye,{children:[e.jsx(Ee,{}),e.jsxs(we,{children:[e.jsx(Pe,{}),e.jsx(Fe,{}),e.jsx(Te,{})]})]}),e.jsx(Oe,{})]}):e.jsx(je,{});export{Ae as default};
