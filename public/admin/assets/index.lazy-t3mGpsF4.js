import{g as w,h as C,u as P,r as l,i as U,k as y,l as d,M as c,m as R,j as t,o as p,B as L,p as S,A as v,e as D}from"./index-V81NBkkY.js";import{T as m}from"./TableView-S32AFz4c.js";import{f as I}from"./_utils-UdYZV02l.js";import{u as z}from"./useModelItems-VEKCkMNE.js";import"./ItemsMissingMessage-x1wK8Oby.js";import"./Skeleton-2hbUmUW0.js";import"./use-disclosure-9tVijqur.js";import"./Drawer-t_RC8ba3.js";import"./NativeScrollArea-3RcdrrPH.js";import"./Overlay-ZRnzj5aG.js";import"./Select-o2HnkTTJ.js";const K=w("/_authorized/users/")({component:B});function B(){const u=C(),{t:n}=P(),[f,j]=l.useState(1),{user:e}=U(),i=y(d.USERS),{data:s,isLoading:N,isError:b,refetch:M}=z(d.USERS,{params:{page:f}}),E=l.useMemo(()=>{if(!s)return!1;const{data:o,...a}=s;return a},[s]),T=l.useMemo(()=>{var x;if(!((x=s==null?void 0:s.data)!=null&&x.length))return[];const o=s.data;if(!e)return o;const a=o.find(r=>r.id===(e==null?void 0:e.id));if(a){a.isMe=!0;const r=` (${n(c.ME)})`;a.email=a.email.replace(r,"")+r}return o},[s,e,n]),g=R({userRole:e.role,action:"update",targetEntityTableName:d.USERS}),h=()=>u({to:"/users/create"}),A=g?o=>{if(o===(e==null?void 0:e.id)){u({to:"/settings/profile"});return}u({to:`/users/${o}`})}:void 0,_=g?async o=>{if(o===(e==null?void 0:e.id)){alert("You cannot delete yourself");return}confirm(n(c.ON_DELETE_REQUEST_PROMPT))&&(await D.users.delete(o),M())}:void 0,k=l.useMemo(()=>{if(i)return I(i)},[i]);return t.jsxs(p,{children:[t.jsx(p.Header,{title:n(c.USERS),classNames:{wrapper:"flex items-center justify-between"},children:(e==null?void 0:e.role)&&R({userRole:e==null?void 0:e.role,action:"create",targetEntityTableName:i.tableName})&&t.jsxs(t.Fragment,{children:[t.jsx(L,{color:"green",className:"font-semibold uppercase hidden md:block",size:"md",onClick:h,leftSection:t.jsx(S,{className:"inline-block h-5 w-5"}),children:t.jsx("span",{className:"hidden md:block",children:n(c.ADD_NEW_USER)})}),t.jsx(v,{color:"green",className:" block md:hidden",size:"xl",onClick:h,children:t.jsx(S,{className:"inline-block h-7 w-7"})})]})}),t.jsxs(p.Content,{children:[t.jsx(m,{isLoading:N||b,items:T,columns:k||[],onEditAction:A,onDeleteAction:_}),t.jsxs(m.Footer,{children:[E&&t.jsx(m.Metadata,{...E}),t.jsx(m.Pagination,{className:"ml-auto",total:(s==null?void 0:s.last_page)||1,value:f,onChange:j})]})]})]})}export{K as Route};
