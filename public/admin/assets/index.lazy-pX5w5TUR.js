import{s as A,z as a,M as o,aK as E,i as R,b as x,u as _,r as D,j as e,c as N,d,B as b,e as j,f as C,aH as I,h as L}from"./index-RZzWi_an.js";import{t as O}from"./toastedPromise-Ygx8j2qQ.js";import{D as W}from"./Drawer-tpPcI0qJ.js";import"./NativeScrollArea-xY8Tlx7e.js";import"./Overlay-yVmGNtgA.js";const y=A(a.object({newPassword:a.string({required_error:o.FIELD_REQUIRED}).min(6,E("Too short, minimum 6 characters")),newPasswordAgain:a.string(),oldPassword:a.string({required_error:o.FIELD_REQUIRED})}).superRefine((r,t)=>{r.newPassword!==r.newPasswordAgain&&t.addIssue({code:a.ZodIssueCode.custom,message:o.PASSWORDS_MUST_MATCH})})),v=()=>{var c,m,w;const r=R(),t=x({resolver:y}),{t:s}=_(),{handleSubmit:p,formState:n,register:l,setError:f}=t,P=D.useCallback(()=>{r({to:"/settings/profile"})},[r]),S=async u=>{var g;if(confirm(s(o.ARE_YOUR_REALLY_SURE)))try{await O({title:s(o.CHANGE_PASSWORD),message:s(o.PLEASE_WAIT),successMessage:s("Password changed successfully. Logging off...")},async()=>{await j.profile.changePassword(u.newPassword,u.oldPassword)}),r({to:"/logout"})}catch(i){if(C.isAxiosError(i)&&I(i.response)){const{code:h}=(g=i.response)==null?void 0:g.data;h==="old-password-invalid"&&f("oldPassword",{message:o.INVALID_OLD_PASSWORD})}throw i}};return e.jsx(W,{opened:!0,onClose:P,padding:32,size:"xl",position:"right",className:"overflow-auto",title:s("Change password"),children:e.jsx(N,{...t,children:e.jsxs("form",{className:"h-full",onSubmit:p(S),children:[e.jsxs("div",{className:"grid w-full max-w-lg gap-4",children:[e.jsx(d,{label:s(o.OLD_PASSWORD),className:"w-full",error:s(((c=n.errors.oldPassword)==null?void 0:c.message)??""),autoComplete:"current-password",...l("oldPassword")}),e.jsx("hr",{className:"bg-gray-200 border-none h-0.5 w-full my-0"}),e.jsx(d,{label:s(o.NEW_PASSWORD),className:"w-full",error:s(((m=n.errors.newPassword)==null?void 0:m.message)??""),autoComplete:"new-password",...l("newPassword")}),e.jsx(d,{label:s(o.NEW_PASSWORD_AGAIN),className:"w-full",error:s(((w=n.errors.newPasswordAgain)==null?void 0:w.message)??""),autoComplete:"off",...l("newPasswordAgain")})]}),e.jsx(b,{loading:n.isSubmitting,type:"submit",className:"mt-5",children:s("Save")})]})})})},G=L("/_authorized/settings/profile/password/change/")({component:()=>e.jsx(v,{})});export{G as Route};
