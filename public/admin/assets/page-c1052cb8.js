import{aT as Q,r as i,J as K,a as I,u as X,aU as ee,aG as se,aV as te,ah as ne,aW as U,o as ae,aX as oe,k as w,b as re,aY as B,ab as W,v as ie,aZ as le,a_ as ce,j as e,ak as ue,ad as G,aQ as de,a$ as L,S as me,i as y,b0 as J,b1 as ge,al as fe,a8 as he,b2 as T,a6 as V,ay as xe,E as z,A as R,T as pe,Z as q,b3 as be,$ as je,y as ye,b4 as we,b5 as Ne,b6 as Se}from"./index-48692a22.js";const ke=s=>{const{singletons:t}=Q();return i.useMemo(()=>t&&t[s],[s,t])},p=(s=!1)=>{const{singletonId:t}=K(),n=i.useMemo(()=>String(t),[t]),a=ke(n);if(s&&!a)throw new Error("Model not found");return i.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},Ce=(s,t)=>{const n=p(!0),a=i.useCallback(()=>I.singletons.getOne(n.key,s).then(({data:r})=>r.data),[n,s]),g=i.useMemo(()=>[n.key],[n.key]),o=X([g,s],a,{...t});return i.useMemo(()=>({...o,key:g}),[g,o])},$=i.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),F=()=>i.useContext($),ve=({children:s})=>{var D;const t=ee(),n=se(),a=p(!0),g=i.useMemo(()=>{if(!a)return;const d=te(a,!0);return async(h,c,b)=>{const S=await ne(d)(h,c,b);return U.warning("Validating form:"),U.warning({data:h,result:S}),S}},[a]),o=ae({defaultValues:oe(a),reValidateMode:"onChange",mode:"onTouched",resolver:g}),{t:r}=w(),[u,k]=i.useState((D=n==null?void 0:n.i18n)==null?void 0:D.default),x=re(),{data:f,isLoading:M,key:C}=Ce({language:u},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:O,setError:E}=o,N=i.useCallback(d=>x.setQueryData(C,d),[C]);i.useEffect(()=>{var d;if(f&&(o.reset({...Object.fromEntries(Object.entries(f).filter(([h,c])=>c!==null)),...f.content?{content:JSON.stringify(f.content)}:{}}),t.refs.current))for(const[h,c]of Object.entries(t.refs.current))f[h]&&((d=c==null?void 0:c.blocks)==null||d.render(f[h]))},[f,o]);const l=O(async d=>{var c,b,S;const h=a.key;if(t.refs.current)for(const[j,m]of Object.entries(t.refs.current))await(m==null?void 0:m.isReady),m&&"save"in m&&(d[j]=JSON.stringify(await m.save()));try{await B({title:"Updating",message:r("Updating, please wait..."),successMessage:r("Your entry is updated!")},async()=>{const j=W(f,d),{data:{data:m}}=await I.singletons.update(h,j,{language:u});N(m)})}catch(j){if(ie.isAxiosError(j)&&le(j.response)&&((b=(c=j.response)==null?void 0:c.data)==null?void 0:b.code)===ce){const m=j.response.data.data;if(Array.isArray(m)&&m.length)for(const P of m){const v=(S=a==null?void 0:a.columns)==null?void 0:S.get(P);let _=P;P==="slug"&&(v==null?void 0:v.type)==="slug"&&(_=v.of),E(_,{message:r("This field is unique and other entry has the same value")})}}}}),A=i.useCallback(async()=>B({message:r("Clearing singleton..."),title:r("Clearing"),errorMessage:r("Failed to clear"),successMessage:r("Clearing successful!")},async()=>{var h,c;const{data:{data:d}}=await I.singletons.clear(a==null?void 0:a.key);if(t.refs.current)for(const b of Object.values(t.refs.current))(c=b==null?void 0:(h=b.blocks).clear)==null||c.call(h);o.reset(d),N(d)}),[N,a,r,t,o.reset]),Z=i.useMemo(()=>({language:u,setLanguage:k,data:f,isLoading:M,clear:A}),[u,k,A]);return e.jsx(ue,{...o,children:e.jsx($.Provider,{value:Z,children:e.jsx("form",{className:"flex",onSubmit:l,children:s})})})},Me=()=>{const{t:s}=w(),{language:t,setLanguage:n}=F(),{settings:a}=Q();return((a==null?void 0:a.i18n.languages.length)??0)<=1?null:e.jsx(G,{title:s("Internationalization"),children:e.jsx("div",{className:"mx-5 mb-5",children:e.jsx(de,{value:t,onChange:g=>g&&n(g),className:"w-full",shadow:"xl"})})})},H=({className:s,...t})=>e.jsx(me,{className:y("relative top-0.5 inline-block h-4",s),...t}),Y="D.M. YYYY, HH:mm",Oe=()=>{const{data:s,isLoading:t}=F(),{t:n}=w(),a=p();return a!=null&&a.hasTimestamps?e.jsx(G,{className:"!pt-0",title:n("Publish info"),children:e.jsx("div",{className:"w-full px-4 py-5",children:e.jsxs("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[e.jsxs("li",{children:[n("Updated at:")," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:s!=null&&s.updated_at?L(s.updated_at).format(Y):n("Not edited yet")})]}),!!(s!=null&&s.created_at)&&e.jsxs("li",{children:[n("Created at:")," ",t?e.jsx(H,{className:"w-full max-w-[6rem]"}):e.jsx("span",{className:"font-semibold text-blue-600",children:L(s.created_at).format(Y)})]})]})})}):null},Ee=()=>{const s=p(!0),{isOpen:t}=J();return e.jsx("aside",{className:y("sticky top-0 z-10 transition-[width] duration-300",t?"w-[500px]":"h-0 w-0 overflow-hidden"),children:e.jsxs("div",{className:y("h-full w-[500px] py-5 pl-8 flex flex-col gap-5"),children:[e.jsx(Oe,{}),e.jsx(Me,{}),e.jsx(ge,{model:s})]})})},Pe=()=>{const{t:s}=w(),t=p(!0);return e.jsx(e.Fragment,{children:e.jsx(fe,{className:"py-5",items:[{content:s("Singletons")},{content:e.jsx("p",{className:"flex-none text-green-500 underline",children:t.title||t.name})}]})})},Te=()=>{const{name:s,title:t,columns:n}=p(!0),{t:a}=w();return i.useMemo(()=>n&&!!Object.entries(Object.fromEntries(n)).find(([o,r])=>!r.hide&&r.editable&&r.admin.editor.placement===he.MAIN&&r.type==="string"&&r.admin.fieldType==="heading"),[n])?null:e.jsxs(T,{children:[e.jsxs(T.Title,{children:[a("Update")," ",t||s]}),e.jsx(T.Divider,{})]})},Ie=()=>{const{watch:s}=V(),t=s(),{t:n}=w(),{isOpen:a,setIsOpen:g}=J(),{data:o,clear:r}=F(),u=p(),{setValue:k,formState:x}=V(),f=i.useMemo(()=>!!Object.keys(W(o||{},t)).length,[t,o]),M=async()=>{confirm(n(je.ON_DELETE_REQUEST_PROMPT))&&await r()},C=()=>{},O=i.useMemo(()=>{let l="";return x.isSubmitting?l="Updating":l="Update",n(l)},[x.isSubmitting,n]),E=i.useMemo(()=>{let l="";return!(u!=null&&u.isDraftable)||!o?l:(o.is_published?l="Unpublish":l="Publish",n(l))},[o,x.isSubmitting,u,n]),N=()=>{k("is_published",o?!o.is_published:!1)};return e.jsxs(xe,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[e.jsx(z,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:e.jsx(R,{size:"xl",type:"button",loading:x.isSubmitting,onClick:M,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:y(x.isSubmitting&&"!cursor-progress"),children:e.jsx(pe,{className:"aspect-square w-10"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[(u==null?void 0:u.isDraftable)&&e.jsx(q,{size:"sm",variant:"white",type:"submit",disabled:x.isSubmitting,className:"ml-auto",onClick:N,px:"sm",children:E}),e.jsx(q,{size:"lg",color:"green",type:"submit",disabled:!f,loading:x.isSubmitting,onClick:C,children:O}),e.jsx(z,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:e.jsx(R,{size:"xl",color:"blue",variant:"light",type:"button",className:y(x.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>g(l=>!l),children:e.jsx(be,{className:y("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},Fe=()=>{const s=p(!0);return e.jsx(Se,{modelInfo:s})},De=({})=>p()?e.jsxs(ve,{children:[e.jsxs(we,{children:[e.jsx(Pe,{}),e.jsxs(Ne,{children:[e.jsx(Te,{}),e.jsx(Fe,{}),e.jsx(Ie,{})]})]}),e.jsx(Ee,{})]}):e.jsx(ye,{});export{De as default};
